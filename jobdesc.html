<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Organization Chart</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #334155;
            margin: 0;
            padding: 0;
        }
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        .org-chart-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: auto;
            min-height: 100vh;
            box-sizing: border-box;
            position: relative;
        }

        .page-title {
            font-size: 1.875rem; 
            line-height: 2.25rem;
            font-weight: 700; 
            color: #1e293b; 
            margin-bottom: 2rem; 
            text-align: center; 
        }
        @media (min-width: 640px) {
            .page-title {
                font-size: 2.25rem;
                line-height: 2.5rem;
            }
        }

        .org-chart {
            display: inline-flex; 
            flex-direction: column;
            align-items: center;
            gap: 50px; 
            padding: 20px;
        }

        .org-node {
            background-color: white;
            border: 1px solid #cbd5e1; 
            border-radius: 12px; 
            padding: 16px;
            text-align: center;
            min-width: 200px;
            max-width: 250px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); 
            position: relative; 
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            cursor: pointer;
            z-index: 1;
        }

        .org-node:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }
        
        .org-node img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 10px auto;
            object-fit: cover;
            border: 2px solid #e2e8f0; 
            background-color: #e2e8f0; /* Fallback background for the img area */
        }

        .org-node .title { /* This will display 'jobPosition' */
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
        }
        
        .org-node .department { /* This will display 'department' (from DirectorDivisionDepartement) */
            font-size: 0.75rem;
            color: #64748b; 
            background-color: #f1f5f9; 
            padding: 2px 6px;
            border-radius: 6px;
            display: inline-block;
        }

        .group-belt { /* Common style for Directorate, Division, Department belts */
            width: 100%; /* Belts span full width */
            max-width: 1400px; /* Optional max width for very wide screens */
            padding: 20px; 
            box-sizing: border-box;
            border-radius: 10px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.07); 
            display: flex; 
            flex-direction: column; 
            align-items: flex-start; 
            border-width: 2px; 
            border-style: solid; 
            position: relative; 
        }
        .group-belt-title {
            font-size: 1.5rem; /* Unified title size */
            font-weight: 600;
            margin-bottom: 15px;
            padding: 6px 12px;
            background-color: rgba(255,255,255,0.4); 
            border-radius: 6px;
        }

        .children-container {
            display: flex;
            justify-content: center;
            gap: 20px; 
            margin-top: 50px; 
            position: relative;
            overflow: hidden; 
            max-height: 1000px; 
            opacity: 1;
            transition: max-height 0.4s cubic-bezier(0.25, 0.1, 0.25, 1), 
                        opacity 0.4s ease-in-out,
                        margin-top 0.4s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        
        .children-container.collapsed {
            max-height: 0;
            opacity: 0;
            margin-top: 0; 
        }
        
        .node-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative; 
        }

        .connector-line {
            stroke: #94a3b8;
            stroke-width: 2;
            fill: none;
            opacity: 0; 
            transition: opacity 0.4s ease-out;
        }
        
        .toggle-button {
            position: absolute;
            bottom: -12px; 
            left: 50%;
            transform: translateX(-50%);
            background-color: #4f46e5; 
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 10; 
            transition: background-color 0.2s;
        }
        .toggle-button:hover {
            background-color: #4338ca; 
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 1000;
        }
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 500px;
            transform: scale(0.95);
            transition: transform 0.3s ease;
            position: relative;
        }
        .modal.active .modal-content {
            transform: scale(1);
        }
        .modal-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #64748b; 
            cursor: pointer;
        }
        .modal-close-btn:hover {
            color: #1e293b; 
        }

        #modalImage {
            width: 6rem;
            height: 6rem;
            border-radius: 9999px;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 1rem;
            border-width: 4px;
            border-style: solid;
            border-color: #c7d2fe;
            object-fit: cover;
            background-color: #e2e8f0; 
        }
        
        #modalTitle { 
            font-size: 1.5rem; 
            line-height: 2rem;
            font-weight: 700;
            color: #1e293b; 
            text-align: center;
            margin-bottom: 0.5rem; 
        }
        #modalDepartment {
            font-size: 1rem; 
            line-height: 1.5rem;
            color: #475569; 
            text-align: center; 
            margin-bottom: 1rem; 
        }
        .modal-contact-details {
            border-top-width: 1px;
            border-top-style: solid;
            border-top-color: #e2e8f0;
            padding-top: 1rem;
            margin-bottom: 1rem;
        }
        .contact-info-item {
            font-size: 0.875rem;
            line-height: 1.25rem;
            color: #64748b;
        }
        .contact-info-item:not(:last-child) {
             margin-bottom: 0.25rem;
        }
        .contact-info-item i {
            margin-right: 0.5rem;
            color: #6366f1;
        }
        #modalBio { /* Can be used for other textual info if needed */
            font-size: 0.875rem;
            line-height: 1.25rem;
            color: #475569;
            margin-top: 1rem;
            background-color: #f8fafc;
            padding: 0.75rem;
            border-radius: 0.5rem;
        }
        #modalJobDescLinkContainer {
            margin-top: 0.5rem;
            text-align: center;
        }
        #modalJobDescLink {
            color: #4f46e5;
            text-decoration: underline;
            font-size: 0.875rem;
        }
        #modalJobDescLink:hover {
            color: #4338ca;
        }

    </style>
</head>
<body>
    <div class="org-chart-container">
        <h1 class="page-title">Our Organization</h1>
        <div id="chart" class="org-chart"></div>
        <svg id="connector-svg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0;"></svg>
    </div>

    <div id="directorate-belt" class="group-belt"> 
        <h2 id="directorate-belt-title" class="group-belt-title">Directorate Level</h2>
        <div id="director-nodes-container" class="belt-items-container"></div>
    </div>

    <div id="nodeModal" class="modal">
        <div class="modal-content">
            <button id="modalCloseBtn" class="modal-close-btn">&times;</button>
            <img id="modalImage" src="" alt="Profile">
            <p id="modalTitle"></p> 
            <p id="modalDepartment"></p>
            <div class="modal-contact-details">
                <p class="contact-info-item"><i class="fas fa-envelope"></i><span id="modalEmail"></span></p>
                <p class="contact-info-item"><i class="fas fa-phone"></i><span id="modalPhone"></span></p>
            </div>
            <div id="modalJobDescLinkContainer">
                 <a id="modalJobDescLink" href="#" target="_blank" rel="noopener noreferrer">View Job Description</a>
            </div>
            <p id="modalBio"></p>
        </div>
    </div>

    <script>
        // New flat data structure
        const flatOrgData = [
            { 
                jobPosition: 'Chief Executive Officer', 
                parentJobPosition: null, 
                department: 'Executive', 
                email: 'ceo@example.com', phone: '555-0001', bio: 'Overall strategic direction.', 
                jobDescriptionLink: 'https://example.com/jd/ceo',
                isCollapsed: false 
            },
            { 
                jobPosition: 'Chief Technology Officer', 
                parentJobPosition: 'Chief Executive Officer', 
                department: 'Technology', 
                email: 'cto@example.com', phone: '555-0002', bio: 'Leads technology strategy.', 
                jobDescriptionLink: 'https://example.com/jd/cto',
                isCollapsed: false 
            },
            { 
                jobPosition: 'VP of Engineering', 
                parentJobPosition: 'Chief Technology Officer', 
                department: 'Engineering', 
                email: 'vp.eng@example.com', phone: '555-0003', bio: 'Manages engineering teams.', 
                jobDescriptionLink: 'https://example.com/jd/vp-eng',
                isCollapsed: true
            },
            { 
                jobPosition: 'Lead Developer - Frontend', 
                parentJobPosition: 'VP of Engineering', 
                department: 'Engineering', 
                email: 'lead.fe@example.com', phone: '555-0004', bio: 'Leads frontend projects.', 
                jobDescriptionLink: 'https://example.com/jd/lead-fe' 
            },
            { 
                jobPosition: 'Lead Developer - Backend', 
                parentJobPosition: 'VP of Engineering', 
                department: 'Engineering', 
                email: 'lead.be@example.com', phone: '555-0005', bio: 'Leads backend projects.', 
                jobDescriptionLink: 'https://example.com/jd/lead-be' 
            },
            { 
                jobPosition: 'Director of IT Operations', 
                parentJobPosition: 'Chief Technology Officer', 
                department: 'IT', 
                email: 'dir.it@example.com', phone: '555-0006', bio: 'Oversees IT infrastructure.', 
                jobDescriptionLink: 'https://example.com/jd/dir-it' 
            },
            { 
                jobPosition: 'Chief Marketing Officer', 
                parentJobPosition: 'Chief Executive Officer', 
                department: 'Marketing', 
                email: 'cmo@example.com', phone: '555-0007', bio: 'Leads marketing strategy.', 
                jobDescriptionLink: 'https://example.com/jd/cmo' 
            },
            { 
                jobPosition: 'Head of Digital Marketing', 
                parentJobPosition: 'Chief Marketing Officer', 
                department: 'Marketing', 
                email: 'head.digital@example.com', phone: '555-0008', bio: 'Manages digital campaigns.', 
                jobDescriptionLink: 'https://example.com/jd/head-digital' 
            },
            { 
                jobPosition: 'Chief Financial Officer', 
                parentJobPosition: 'Chief Executive Officer', 
                department: 'Finance', 
                email: 'cfo@example.com', phone: '555-0009', bio: 'Manages company finances.', 
                jobDescriptionLink: 'https://example.com/jd/cfo',
                isCollapsed: true
            },
            { 
                jobPosition: 'Accounting Manager', 
                parentJobPosition: 'Chief Financial Officer', 
                department: 'Finance', 
                email: 'acc.mgr@example.com', phone: '555-0010', bio: 'Oversees accounting.', 
                jobDescriptionLink: 'https://example.com/jd/acc-mgr' 
            }
        ];

        const chartRootElement = document.getElementById('chart');
        const svgContainer = document.getElementById('connector-svg');
        const nodeModal = document.getElementById('nodeModal');
        const modalCloseBtn = document.getElementById('modalCloseBtn');
        const scrollableChartContainer = document.querySelector('.org-chart-container');
        let organizationData = null; // Will hold the hierarchical data

        /**
         * Generates initials from a job title.
         */
        function getInitials(title) {
            if (!title) return 'N/A';
            const commonWords = ['of', 'the', 'and', 'for', 'in', 'on', 'at', 'to', 'with', 'a'];
            const words = title.split(' ')
                               .filter(word => word && !commonWords.includes(word.toLowerCase()));
            
            let initials = '';
            if (words.length === 1) {
                initials = words[0].substring(0, Math.min(words[0].length, 2)).toUpperCase();
            } else if (words.length === 2) {
                initials = (words[0][0] + words[1][0]).toUpperCase();
            } else if (words.length >= 3) {
                initials = (words[0][0] + words[1][0] + words[2][0]).toUpperCase();
            } else if (words.length > 0) { 
                 initials = words.map(w => w[0]).join('').substring(0,3).toUpperCase();
            } else { 
                initials = title.substring(0, Math.min(title.length, 2)).toUpperCase();
            }
            return initials.substring(0,3);
        }
        
        /**
         * Builds a hierarchical data structure from a flat list of jobs.
         */
        function buildHierarchy(flatData) {
            if (!flatData || flatData.length === 0) return null;
            const jobMap = {}; 
            const roots = [];  

            flatData.forEach(job => {
                jobMap[job.jobPosition] = { 
                    id: job.jobPosition,    
                    title: job.jobPosition,
                    department: job.department,
                    email: job.email,
                    phone: job.phone,
                    bio: job.bio,
                    jobDescriptionLink: job.jobDescriptionLink,
                    // Use the isCollapsed from flatData, default to false if not present
                    isCollapsed: job.isCollapsed !== undefined ? job.isCollapsed : false,
                    children: []
                };
            });

            flatData.forEach(job => {
                const node = jobMap[job.jobPosition]; 
                if (job.parentJobPosition && jobMap[job.parentJobPosition]) {
                    jobMap[job.parentJobPosition].children.push(node);
                } else if (!job.parentJobPosition) {
                    roots.push(node);
                } else {
                    console.warn(`Job "${job.jobPosition}" has parent "${job.parentJobPosition}" not found. Treating as a root.`);
                    roots.push(node);
                }
            });

            if (roots.length === 0 && flatData.length > 0) {
                console.error("No root nodes found. Displaying first available job as root.");
                return jobMap[Object.keys(jobMap)[0]] || null; 
            }
            if (roots.length > 1) {
                console.warn(`Multiple root nodes found. Displaying based on the first root: "${roots[0].title}".`);
            }
            return roots[0] || null; 
        }

        /**
         * Finds a node by its ID in the hierarchical data structure.
         */
        function findNodeById(node, id) {
            if (!node) return null;
            if (node.id === id) return node;
            if (node.children) {
                for (const child of node.children) {
                    const found = findNodeById(child, id);
                    if (found) return found;
                }
            }
            return null;
        }
        
        function toggleCollapse(nodeId) {
            // Find the item in flatOrgData to persist the state
            const flatDataNode = flatOrgData.find(job => job.jobPosition === nodeId);
            if (flatDataNode) {
                // If isCollapsed is not defined, initialize it based on current state or default to false before toggling
                if (flatDataNode.isCollapsed === undefined) {
                    // Check current hierarchical state if available, otherwise default
                    const currentHierarchicalNode = organizationData ? findNodeById(organizationData, nodeId) : null;
                    flatDataNode.isCollapsed = currentHierarchicalNode ? currentHierarchicalNode.isCollapsed : false;
                }
                flatDataNode.isCollapsed = !flatDataNode.isCollapsed; // Toggle the state in flatOrgData
                renderChart(); // Re-render; buildHierarchy will now use the updated state
            } else {
                console.warn(`Node with ID "${nodeId}" not found in flatOrgData for toggling collapse.`);
            }
        }

        function createNodeElement(nodeData) {
            const nodeEl = document.createElement('div');
            nodeEl.classList.add('org-node');
            nodeEl.setAttribute('data-id', nodeData.id); 

            const initials = getInitials(nodeData.title);
            const randomHexColor = Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
            const imageUrl = `https://placehold.co/100x100/${randomHexColor}/FFFFFF?text=${initials}&font=Inter`;

            nodeEl.innerHTML = `
                <img src="${imageUrl}" alt="${nodeData.title} - ${initials}" onerror="this.onerror=null;this.src='https://placehold.co/100x100/CBD5E1/FFFFFF?text=Err&font=Inter';">
                <div class="title">${nodeData.title}</div> 
                ${nodeData.department ? `<div class="department">${nodeData.department}</div>` : ''}
            `;

            nodeEl.addEventListener('click', (e) => {
                if (e.target.closest('.toggle-button')) return;
                openModal(nodeData);
            });

            if (nodeData.children && nodeData.children.length > 0) {
                const toggleBtn = document.createElement('button');
                toggleBtn.classList.add('toggle-button');
                // Set icon based on the nodeData.isCollapsed from the *hierarchical* structure
                // This is correct as nodeData here is from the built hierarchy
                toggleBtn.innerHTML = nodeData.isCollapsed ? '<i class="fas fa-plus"></i>' : '<i class="fas fa-minus"></i>';
                toggleBtn.addEventListener('click', (e) => {
                    e.stopPropagation(); 
                    toggleCollapse(nodeData.id);
                });
                nodeEl.appendChild(toggleBtn);
            }
            return nodeEl;
        }

        function renderRecursive(parentNodeData, parentElementInDOM) {
            if (!parentNodeData) return; 
            const nodeEl = createNodeElement(parentNodeData);
            const nodeWrapper = document.createElement('div');
            nodeWrapper.classList.add('node-wrapper');
            nodeWrapper.appendChild(nodeEl); 

            if (parentNodeData.children && parentNodeData.children.length > 0) {
                const childrenContainerEl = document.createElement('div');
                childrenContainerEl.classList.add('children-container');

                if (parentNodeData.isCollapsed) {
                    childrenContainerEl.classList.add('collapsed');
                } else {
                    parentNodeData.children.forEach(childNodeData => {
                        renderRecursive(childNodeData, childrenContainerEl); 
                    });
                }
                nodeWrapper.appendChild(childrenContainerEl);
            }
            parentElementInDOM.appendChild(nodeWrapper); 
        }
        
        function drawLines() {
            svgContainer.innerHTML = ''; 
            if (!organizationData) return; 

            const containerRect = scrollableChartContainer.getBoundingClientRect();
            const currentScrollLeft = scrollableChartContainer.scrollLeft;
            const currentScrollTop = scrollableChartContainer.scrollTop;

            const rootNodeWrapper = chartRootElement.querySelector(':scope > .node-wrapper');
            if (rootNodeWrapper) {
                 drawLinesRecursive(rootNodeWrapper, containerRect, currentScrollLeft, currentScrollTop);
            }
            
            let maxX = 0, maxY = 0;
            svgContainer.querySelectorAll('line').forEach(line => {
                maxX = Math.max(maxX, parseFloat(line.getAttribute('x1')), parseFloat(line.getAttribute('x2')));
                maxY = Math.max(maxY, parseFloat(line.getAttribute('y1')), parseFloat(line.getAttribute('y2')));
            });
            svgContainer.style.width = `${Math.max(maxX, scrollableChartContainer.scrollWidth)}px`;
            svgContainer.style.height = `${Math.max(maxY, scrollableChartContainer.scrollHeight)}px`;

            const allConnectorLines = svgContainer.querySelectorAll('.connector-line');
            requestAnimationFrame(() => { 
                allConnectorLines.forEach(line => {
                    line.style.opacity = 1; 
                });
            });
        }

        function drawLinesRecursive(parentNodeWrapper, containerRect, currentScrollLeft, currentScrollTop) {
            const parentNodeEl = parentNodeWrapper.querySelector(':scope > .org-node');
            if (!parentNodeEl) return;

            const parentDataId = parentNodeEl.dataset.id;
            const parentNodeData = findNodeById(organizationData, parentDataId); 

            const childrenContainer = parentNodeWrapper.querySelector(':scope > .children-container');
            if (parentNodeData && parentNodeData.children && parentNodeData.children.length > 0 && childrenContainer && !childrenContainer.classList.contains('collapsed')) {
                const parentRect = parentNodeEl.getBoundingClientRect();
                const parentSvgCenterX = parentRect.left - containerRect.left + parentRect.width / 2 + currentScrollLeft;
                const parentSvgBottomY = parentRect.bottom - containerRect.top + currentScrollTop;
                 
                const horizontalLineY = parentSvgBottomY + 25; 
                const lineStartOffsetY = parentNodeEl.querySelector('.toggle-button') ? 12 : 0;

                childrenContainer.querySelectorAll(':scope > .node-wrapper').forEach(childNodeWrapper => {
                    const childNodeEl = childNodeWrapper.querySelector(':scope > .org-node');
                    if (!childNodeEl) return;

                    const childRect = childNodeEl.getBoundingClientRect();
                    const childSvgCenterX = childRect.left - containerRect.left + childRect.width / 2 + currentScrollLeft;
                    const childSvgTopY = childRect.top - containerRect.top + currentScrollTop;

                    const line1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line1.setAttribute('x1', parentSvgCenterX);
                    line1.setAttribute('y1', parentSvgBottomY + lineStartOffsetY); 
                    line1.setAttribute('x2', parentSvgCenterX);
                    line1.setAttribute('y2', horizontalLineY); 
                    line1.classList.add('connector-line'); 
                    svgContainer.appendChild(line1);

                    const line2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line2.setAttribute('x1', parentSvgCenterX);
                    line2.setAttribute('y1', horizontalLineY);
                    line2.setAttribute('x2', childSvgCenterX);
                    line2.setAttribute('y2', horizontalLineY);
                    line2.classList.add('connector-line');
                    svgContainer.appendChild(line2);
                    
                    const line3 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line3.setAttribute('x1', childSvgCenterX);
                    line3.setAttribute('y1', horizontalLineY);
                    line3.setAttribute('x2', childSvgCenterX);
                    line3.setAttribute('y2', childSvgTopY);
                    line3.classList.add('connector-line');
                    svgContainer.appendChild(line3);

                    drawLinesRecursive(childNodeWrapper, containerRect, currentScrollLeft, currentScrollTop);
                });
            }
        }

        function renderChart() {
            organizationData = buildHierarchy(flatOrgData); 
            chartRootElement.innerHTML = ''; 
            if (organizationData) { 
                renderRecursive(organizationData, chartRootElement); 
            } else {
                chartRootElement.innerHTML = '<p style="text-align:center; color: #ef4444;">Could not build organization chart. Please check data structure.</p>';
            }
            
            requestAnimationFrame(() => {
                 setTimeout(drawLines, 10); 
            });
        }
        
        function openModal(nodeData) {
            const initials = getInitials(nodeData.title);
            const modalImageUrl = `https://placehold.co/100x100/A0AEC0/FFFFFF?text=${initials}&font=Inter`; 
            
            document.getElementById('modalImage').src = modalImageUrl;
            document.getElementById('modalImage').alt = `${nodeData.title} - ${initials}`;
            document.getElementById('modalImage').onerror = function() { this.onerror=null; this.src='https://placehold.co/100x100/CBD5E1/FFFFFF?text=Err&font=Inter'; };
            
            document.getElementById('modalTitle').textContent = nodeData.title;
            document.getElementById('modalDepartment').textContent = nodeData.department || 'N/A';
            document.getElementById('modalEmail').textContent = nodeData.email || 'N/A';
            document.getElementById('modalPhone').textContent = nodeData.phone || 'N/A';
            
            const jobDescLinkEl = document.getElementById('modalJobDescLink');
            const jobDescContainerEl = document.getElementById('modalJobDescLinkContainer');
            if (nodeData.jobDescriptionLink) {
                jobDescLinkEl.href = nodeData.jobDescriptionLink;
                jobDescLinkEl.textContent = 'View Job Description'; 
                jobDescContainerEl.style.display = 'block';
            } else {
                jobDescContainerEl.style.display = 'none';
            }
            
            document.getElementById('modalBio').textContent = nodeData.bio || 'No additional information available.';
            nodeModal.classList.add('active');
        }

        function closeModal() {
            nodeModal.classList.remove('active');
        }

        modalCloseBtn.addEventListener('click', closeModal);
        nodeModal.addEventListener('click', (e) => { 
            if (e.target === nodeModal) {
                closeModal();
            }
        });
        
        renderChart(); // Initial render

        window.addEventListener('resize', () => {
            clearTimeout(window.resizeTimer);
            window.resizeTimer = setTimeout(drawLines, 250);
        });

    </script>
</body>
</html>
