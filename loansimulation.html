<!DOCTYPE html>
<html lang="en">
<head>
<!-- Orange: #D15B28
Tile : #176980 -->
<!-- Add Font Awesome CDN for icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500;600&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cleave.js/1.6.0/cleave.min.js"></script>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- <img src="https://drive.google.com/uc?export=view&id=1vWROesjizhti9mlBCwDD04mNIX4lJb1c" alt="Logo" loading="lazy" style="width: 700px;"> -->

<!-- https://drive.google.com/file/d/1vWROesjizhti9mlBCwDD04mNIX4lJb1c/view?usp=drive_link -->
<title>Hi Simulasi Pinjaman Karyawan</title>

<!-- Style for Header & Footer Section -->
<style>
    .site-header {
    background-color: white;
    padding: 15px 0;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    width: 100%;
    position: fixed;
    top: 0;
    left: 0; /* Ensure header starts from the left edge */
    right: 0; /* Ensure header extends to right edge */
    z-index: 1000;
}

.header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
}

.logo-container img {
    height: 50px;
    width: auto;
}

.site-footer {
    background-color: #176980;
    color: white;
    padding: 15px 0;
    width: 100%;
    text-align: center;
    font-size: 14px;
    margin-top: auto;
    position: relative;
    left: 0; /* Ensure footer starts from the left edge */
    right: 0; /* Ensure footer extends to right edge */
}

/* Update body padding */
body {
    font-family: Jost;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    padding-top: 80px;
    overflow-x: hidden; /* Prevent horizontal scrolling */
}

.site-footer {
    background-color: #176980;
    color: white;
    padding: 15px 0;
    width: 100%;
    text-align: center;
    font-size: 14px;
    margin-top: 1%;
    position: relative;
    bottom: 0;
}

.footer-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
}
</style>

<!-- Style for Component -->
<style>
    label {
    margin-top: 0px;
    }

    input, select {
    width: 100%;
    padding: 8px;
    margin: 5px 0;
    border: 1px solid #ccc;
    border-radius: 4px;
    }

    button {
    padding: 10px 15px;
    background-color: #4CAF50;
    color: white;
    border: none;
    cursor: pointer;
    }

    button:hover {
    background-color: #45a049;
    }

    #chckbtn {
        transition: all 0.2s ease-in-out;
        border: none;
        background: linear-gradient(45deg, #176980, #1a7b96);
    }

    #chckbtn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(23, 105, 128, 0.2);
    }

    #chckbtn:active {
        transform: translateY(0);
    }

    input, select {
        width: 100%;
        padding: 8px;
        margin: 0px 0; /* Reduced from 1px */
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    .mb-3 {
        margin-bottom: 12px; /* Reduced from default bootstrap's 1rem (16px) */
    }

    h1 {
        text-align: center;
        margin: 0 auto;
        padding: 30px 0;
        color: #176980;
        font-weight: 600;
        font-size: 2.5rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-bottom: 3px solid #D15B28;
        width: fit-content;
        margin-bottom: 40px;
    }
</style>

<!-- Style for Table -->
<style>
    .simulation-header {
        width: 100%;
        text-align: center;
        margin-bottom: 25px;
    }

    .simulation-header h3 {
        color: #176980;
        font-weight: 600;
        margin: 0;
        font-size: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .header-line {
        margin-top: 10px;
        height: 3px;
        background: linear-gradient(to right, #D15B28, rgba(209, 91, 40, 0.2));
        border-radius: 2px;
    }

    .table {
        width: 100%;
        table-layout: auto;
    }

    .table-responsive {
        overflow-x: auto;
        width: 100%;
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    }

    .table-wrapper {
        border-radius: 12px;
        background: white;
        padding: 1px;
        margin-top: 20px;
        overflow: hidden;
        width: 100%;
    }

    .sticky-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
    }

    .sticky-table th {
        background-color: #176980;
        color: white;
        font-weight: 500;
        padding: 15px;
        text-align: center;
        white-space: nowrap;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }

    .sticky-table td {
        padding: 12px 15px;
        border-bottom: 1px solid #eee;
        text-align: right;
        font-size: 14px;
    }

    .sticky-table tr:hover {
        background-color: #f8f9fa;
        transition: background-color 0.2s ease;
    }

    .sticky-table tr:last-child {
        font-weight: bold;
        border-top-right-radius: 12px;
    }

    .sticky-table tr:last-child td {
        border-bottom: none;
    }   

    /* Column specific styles */
    .sticky-table td:first-child {
        text-align: center;
        font-weight: 500;
        border-top-left-radius: 12px;
    }

    .sticky-table td:not(:first-child) {
        text-align: right;
        white-space: nowrap;
        color: #444;
    }

    .sticky-table td span {
        display: inline-block;
    }
</style>

<!-- Style for Container -->
<style>
    .container {
        flex: 1;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        width: 100%;
        max-width: 1800px;
        margin: 0 auto;
        padding: 20px;
        gap: 0px; /* Added gap property to control space between containers */
        box-sizing: border-box;
    }

    .result-container {
        width: 100%;
        max-width: calc(50% - 10px);
        padding: 20px; /* Changed from padding-left only */
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        height: auto;
        overflow-y: auto;
        overflow-x: auto;
        font-size: x-small;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .form-container {
        position: sticky;
        top: 20px;
        width: 100%;
        max-width: 800px; /* Increased from 600px */
        margin: 0 auto;
        padding: 40px; /* Increased padding */
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .form-container, .result-container {
        width: 100%;
        max-width: calc(50% - 10px); /* Adjusted to account for gap */
        margin-bottom: 20px;
        box-sizing: border-box;
    }

    .form-container form {
        display: grid;
        gap: 20px; /* Consistent spacing between form elements */
     }

    .form-container .row {
        margin-bottom: 20px; /* Add space between row elements */
    }

    .form-container label {
        font-weight: 500;
        margin-bottom: 0px; /* Reduced from 1px */
        color: #176980;
    }

    .form-container input,
    .form-container select {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
        width: 100%;
        transition: border-color 0.3s;
    }

    .form-container input:focus,
    .form-container select:focus {
        border-color: #176980;
        outline: none;
        box-shadow: 0 0 0 2px rgba(23, 105, 128, 0.1);
    }

    .form-container button {
        background-color: #176980;
        color: white;
        padding: 12px 24px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .form-container button:hover {
        background-color: #145d70;
    }

</style>

<!-- Style for Responsize Size -->
<style>
    @media (max-width: 1920px) {
        .container {
            max-width: 1600px;
        }
    }

    @media (max-width: 1440px) {
        .container {
            flex-direction: column;
            gap: 15px;
        }
        
        .form-container {
        order: 1;
        width: 100%;
        min-width: 100%;
        margin-bottom: 15px;
        }

        .result-container {
        order: 0; 
        width: 100%;
        min-width: 100%;
        }

        .form-container, .result-container {
            width: 100%;
            max-width: 100%;
            padding: 30px;
        }
    }

    @media (max-width: 992px) {
        .container {
            flex-direction: column;
            gap: 15px;
        }
        
        .form-container {
        order: 1;
        width: 100%;
        min-width: 100%;
        margin-bottom: 15px;
        }

        .result-container {
        order: 0; 
        width: 100%;
        min-width: 100%;
        }

        .form-container, .result-container {
            width: 100%;
            max-width: 100%;
            padding: 30px;
        }
    }

    @media (max-width: 768px) {
        h1 {
            font-size: 1.8rem;
            padding: 20px 0;
            margin-bottom: 20px;
        }

        .simulation-header h3 {
            font-size: 1.3rem;
        }

        .form-container label {
            font-size: 0.95rem;
        }

        .sticky-table {
            font-size: 0.75rem; /* Smaller font for table on mobile */
        }

        .form-container {
            padding: 20px 15px;
            margin: 10px 0;
            box-shadow: 0 1px 8px rgba(0, 0, 0, 0.08);
        }

        .form-container input,
        .form-container select {
            padding: 12px; /* Larger touch targets */
            margin: 4px 0;
            font-size: 16px; /* Prevent zoom on iOS */
        }

        .form-container .row {
            margin-bottom: 15px;
        }

        /* Better button layout for mobile */
        .d-flex.gap-2 {
            flex-direction: column;
            gap: 10px !important;
        }

        .d-flex.gap-2 button {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
        }

        .result-container {
            padding: 10px;
            margin-top: 20px;
        }

        .table-wrapper {
            margin: 10px 0;
            border-radius: 8px;
        }

        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 0 -15px;
            padding: 0 15px;
        }

        .sticky-table td, 
        .sticky-table th {
            padding: 10px 8px;
            white-space: nowrap;
        }

        .modal-content {
            width: 95%;
            margin: 10px auto;
            padding: 15px;
        }

        .modal {
            padding-top: 30px;
        }

        .modal-close {
            padding: 10px;
        }

        #initialInfoBoard .modal-content {
            padding: 20px;
        }

        #initialInfoBoard ul li {
            font-size: 14px;
            margin-bottom: 8px;
        }

        #floatingBox {
            width: 85%;
            bottom: 70px;
            right: 50%;
            transform: translateX(50%);
        }

        #toggleButton {
            width: auto;
            right: 50%;
            transform: translateX(50%);
            padding: 10px 20px;
            font-size: 14px;
        }
    }

    @media (max-width: 480px) {
        .container {
            padding: 5px;
        }

        .form-container, .result-container {
            padding: 15px;
        }

        h1 {
            font-size: 1.8rem;
            padding: 20px 0;
        }
    }
</style>

<!-- Style for Modal (NOtification/Alert) -->
<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6); /* Darker overlay */
        backdrop-filter: blur(5px); /* Add blur effect */
        -webkit-backdrop-filter: blur(5px); /* For Safari support */
        overflow: auto;
        padding-top: 60px;
    }

    .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border: none;
        border-radius: 12px;
        width: 80%;
        max-width: 600px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        animation: modalFadeIn 0.3s ease-out;
    }

    @keyframes modalFadeIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .modal-header {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .modal-body {
        font-size: 16px;
    }

    .modal-close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .modal-close:hover,
    .modal-close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
</style>

<!-- Style for Iniatial Board -->
<style>
    #initialInfoBoard .modal-content {
        padding: 30px;
        border-radius: 12px;
        border: none;
        /* box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); */
    }

    #initialInfoBoard ul li {
        margin-bottom: 10px;
        font-size: 16px;
        color: #555;
    }

    #initialInfoBoard .modal-header h4 {
        margin: 0;
        padding-bottom: 15px;
        border-bottom: 2px solid #D15B28;
    }
</style>

<!-- Style Floating Box & Button-->
<style>
    #floatingBox {
        position: fixed;
        bottom: 80px;
        right: 20px;
        width: 300px;
        padding: 20px;
        background-color: white;
        border-radius: 10px;
        border: 1px solid #e0e0e0;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: none;
        z-index: 100;
        transition: all 0.3s ease;
    }

    #floatingBox .card-body {
        padding: 0;
    }

    #floatingBox h6 {
        color: #176980;
        font-weight: 600;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #D15B28;
    }

    #floatingBox p {
        margin: 0;
        font-size: 14px;
        color: #555;
        line-height: 1.6;
    }

    /* Button to toggle floating box */
    #toggleButton {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 12px 20px;
        background-color: #176980;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(23, 105, 128, 0.2);
    }

    #toggleButton:hover {
        background-color: #145d70;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(23, 105, 128, 0.3);
    }
</style>

<!-- Style Tooltip-->
<style>
    .tooltip {
        position: relative;
        display: inline-block;
        cursor: pointer
    }

    .tooltip .tooltiptext {
        visibility: hidden; /* Hidden by default */
        width: 300%;
        background-color: rgb(23, 105, 128);
        color: #fdfdfd;
        text-align: center;
        padding: 5px 10px;
        border-radius: 6px;
        /* Position the tooltip text */
        position: absolute;
        z-index: 1;
        top: -60%; /* Position above the icon */
        left: 190%;
        margin-left: -80px; /* Center the tooltip */
        opacity: 0; /* Make it fully transparent */
        transition: opacity 0.3s, visibility 0s 0.3s; /* Transition for opacity */
        white-space: normal; /* Allow text wrapping */
        word-wrap: break-word; /* Ensures long words wrap to the next line */
    }

    /* Show the tooltip when hovering over the icon */
    .tooltip:hover .tooltiptext {
        visibility: visible; /* Make it visible when hovered */
        opacity: 1; /* Fade in the tooltip */
        transition: opacity 0.3s; /* Smooth transition */
    }

    /* Icon styling */
    #gajiTooltipIcon {
        color: #007bff;
        cursor: pointer;
        margin-left: 5px;
        font-size: 16px;
    }

    /* Ensure the icon is aligned with the label */
    label[for="gajiPokok"] {
        display: flex;
        align-items: center;
    }
</style>

</head>

<body>

<!-- Initial Information Board Section -->
<div id="initialInfoBoard" class="modal" style="display: block;">
    <div class="modal-content" style="max-width: 800px;"> <!-- Increased width -->
        <span class="modal-close" onclick="closeInitialInfo()">&times;</span>
        <div class="modal-header" style="color: #176980;">
            <h4>Selamat Datang di Simulasi Pinjaman Karyawan</h4>
        </div>
        <div class="modal-body">
            <h6 style="color: #176980; margin-top: 20px;">Syarat & Ketentuan Umum:</h6>
                <ul style="list-style-type: none; padding-left: 0;">
                    <li>✓ Status karyawan tetap</li>
                    <li>✓ Minimal masa kerja 2 tahun</li>
                    <li>✓ Usia minimal 21 tahun</li>
                    <li>✓ Memiliki rekening HiBank</li>
                    <li>✓ Melampirkan slip gaji terakhir</li>
                    <li>✓ Memiliki kinerja yang baik dengan penilaian minimum Met atau setara</li>
                    <li>✓ Tidak sedang dalam masa sanksi atau pembinaan kinerja (SP/PIP)</li>
                    <li>✓ IDEB SLIK dalam 12 bulan terakhir menunjukkan kolektibilitas Lancar</li>
                    <li>✓ Jaminan Tanah/Bangunan atas nama Hak Milik pribadi</li>
                    <li>✓ Melengkapi formulir pengajuan dan dokumen yang dibutuhkan</li>
                    <li>✓ DBR (Debt Burden Ratio) maksimal sesuai ketentuan</li>
                </ul>
            <div class="loan-info">

                <h5 style="color: #176980; margin-top: 20px;">Informasi Produk Pinjaman:</h5>
                
                <div class="loan-type">
                    <h6 style="color: #D15B28;">1. Kredit Pemilikan Rumah (KPR)</h6>
                    <ul>
                        <li>Penggunaan: Pembelian rumah, apartemen, atau ruko</li>
                        <li>Plafon: Maksimum Rp5 miliar</li>
                        <li>Tenor: Maksimal 20 tahun atau hingga usia 55 tahun saat jatuh tempo</li>
                        <li>Uang Muka: 10% untuk rumah, 30% untuk ruko</li>
                        <li>Suku Bunga: 5% (fixed rate)</li>
                    </ul>
                </div>

                <div class="loan-type">
                    <h6 style="color: #D15B28;">2. Kredit Multi Guna (KMG)</h6>
                    <ul>
                        <li>Penggunaan: Renovasi rumah dan kebutuhan lainnya</li>
                        <li>Plafon: Maksimum Rp500 juta</li>
                        <li>Tenor: 5 tahun</li>
                        <li>Suku Bunga: 7% (fixed rate)</li>
                    </ul>
                </div>

                <div class="loan-type">
                    <h6 style="color: #D15B28;">3. Kredit Kendaraan Bermotor (KKB)</h6>
                    <ul>
                        <li>Penggunaan: Pembelian mobil dan motor</li>
                        <li>Plafon: Maksimum Rp700 juta</li>
                        <li>Tenor: 5 tahun (3 tahun untuk kendaraan full listrik)</li>
                        <li>Suku Bunga: 4% (umum), 3.5% (kendaraan full listrik)</li>
                    </ul>
                </div>

                <div class="loan-type">
                    <h6 style="color: #D15B28;">4. Emergency Loan</h6>
                    <ul>
                        <li>Penggunaan: Medis, bantuan finansial, atau pendidikan anak kandung</li>
                        <li>Plafon: Maksimum Rp100 juta</li>
                        <li>Tenor: 1 tahun</li>
                        <li>Suku Bunga: 0%</li>
                    </ul>
                </div>

                <div class="loan-type">
                    <h6 style="color: #D15B28;">5. Debt Burden Ratio (DBR)</h6>
                    <ul>
                        <li>Penghasilan ≤ Rp10 juta: 30%</li>
                        <li>Penghasilan Rp10–50 juta: 35%</li>
                        <li>Penghasilan > Rp50 juta: 40%</li>
                    </ul>
                </div>

               
                
                <button onclick="closeInitialInfo()" class="btn btn-primary" style="background-color: #176980; margin-top: 20px;">
                    Mulai Simulasi
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Header Section -->
<header class="site-header">
    <div class="header-content">
        <div class="logo-container">
            <img src="https://script.google.com/macros/s/1LIvASx0b3Fe0KcLSsOc0lYo-LVRhuVkB/exec" alt=" hibank Bubble" width="200">
        </div>
    </div>
</header>

<h1>Simulasi Pinjaman Karyawan</h1>
<div class="container">
<div class="form-container">

<form id="loanForm" novalidate>

<div class="row g-3 align-items-end">
    <div class="col-md-5 col-sm-12">
        <label for="nik" class="form-label">Nomor Induk Karyawan (NIK)</label>
        <div class="input-group">
            <input type="text" class="form-control" id="nik" required 
                   aria-describedby="nikHelp" pattern="[0-9]+" minlength="6" maxlength="6"
                   placeholder="Masukkan NIK">
                <button id="chckbtn" class="btn btn-primary rounded-pill d-flex align-items-center justify-content-center shadow-sm hover-lift" type="button" onclick="getData()" style="width: 38px; height: 38px; margin: auto 0;">
                    <i class="fas fa-search fa-sm"></i>
                </button>
            <div class="invalid-feedback">Please enter a valid NIK</div>
        </div>
</div>
    <div class="col-md-7 col-sm-12">
        <label for="name" class="form-label">Name</label>
        <input type="text" class="form-control" id="name" disabled
               placeholder="Name will appear here">
    </div>
</div>

<div class="row g-3 align-items-end">
    <div class="col-md-8">
        <div class="form-group">
            <label for="tipePinjaman" style="margin-bottom: 0;">Tipe Pinjaman</label>
            <select id="tipePinjaman" class="form-select" aria-label="Default select example" required onchange="updateBunga(),updateDP()" style="margin-top: 2px;">
                <option selected>--Pilih Tipe Pinjaman--</option>
                <option value="Kredit Pemilikan Rumah (KPR)">Kredit Pemilikan Rumah (KPR)</option>
                <option value="Kredit Pemilikan Ruko">Kredit Pemilikan Ruko</option>
                <option value="Kredit Multi Guna (KMG)">Kredit Multi Guna (KMG)</option>
                <option value="Kredit Kendaraan Bermotor (KKB)">Kredit Kendaraan Bermotor (KKB)</option>
                <option value="Kredit Kendaraan Bermotor - Electronic Vehicle">Kredit Kendaraan Bermotor - Electronic Vehicle</option>
                <option value="Emergency Loan">Emergency Loan</option>
            </select>
        </div>
    </div>
    
    <div class="col-md-4">
        <label for="dp" class="form-label">Down Payment (DP)</label>
        <input type="text" id="dp" class="form-control" disabled>
    </div>
</div>  

<div class="mb-3">
    <label for="plafond" class="form-label">Plafond Pinjaman</label>
    <input type="text" class="form-control" id="plafond" required>
</div>

<div class="mb-3">
    <label for="jangkaWaktu" class="form-label">Jangka Waktu (Bulan) </label>
    <input type="number" class="form-control" id="jangkaWaktu" required>
</div>

<div class="mb-3">
    <label for="bunga">Bunga Pinjaman</label>
    <input type="text" id="bunga" disabled>
</div>

<div class="mb-3">
    <label for="gajiPokok" class="form-label">
        Gaji Pokok
        <i class="fas fa-info-circle" data-bs-toggle="tooltip" title="Jika Joint Income dengan penghasilan pasangan (suami/istri), maka harap mencantumkan total penjumlahan Gaji Pokok."></i>
    </label>

    <input type="text" class="form-control" id="gajiPokok" required onchange="updateDBR()">
</div>

<div class="mb-3">
    <label for="dbr">DBR</label>
    <input type="text" id="dbr" disabled>
</div>

<div class="mb-3">
    <label for="cicilanBerjalan">Cicilan Berjalan
        <i class="fas fa-info-circle" data-bs-toggle="tooltip" title="Jika memiliki cicilan pinjaman yang masih aktif di Hibank dan di luar Hibank, maka harap dicantumkan total cicilan tersebut."></i>
    </label>
    <input type="text" id="cicilanBerjalan" value=0>
</div>

<div class="d-flex gap-2">
    <button type="button" class="btn btn-success btn-sm px-3" onclick="genHitung()">Hitung</button>
    <button type="button" class="btn btn-secondary btn-sm px-3" onclick="resetForm()">Reset</button>
    <button type="button" id="downloadPdfButton" class="btn btn-primary btn-sm px-3">Download PDF</button>
</div>

</form>
<!-- <h3 id="error" >error handling</h3> -->

<!-- Floating Box Section -->
<div id="floatingBox" class="card">
    <div class="card-body">
        <h6>Syarat & Ketentuan:</h6>
        <p>• Minimal masa kerja 1 tahun</p>
        <p>• Status karyawan tetap</p>
        <p>• Usia minimal 21 tahun</p>
        <p>• Memiliki rekening HiBank</p>
        <p>• Melampirkan slip gaji terakhir</p>
        <p>• DBR (Debt Burden Ratio) maksimal sesuai ketentuan</p>
    </div>
</div>

<!-- Button to toggle visibility of floating box -->
<button id="toggleButton" class="btn">
    <i class="fas fa-info-circle"></i> Info
</button>
</div>

<!-- Result Container -->
<div class="result-container">
    <div id="result"></div>
    </div>
</div>

<!-- Custom Modal -->
<div id="alertModal" class="modal">
    <div class="modal-content">
        <span class="modal-close" onclick="closeModal()">&times;</span>
            <div class="modal-header" id="modalTitle"></div>
        <div class="modal-body" id="modalMessage"></div>
    </div>
</div>

<footer class="site-footer">
    <div class="footer-content">
        <p>&copy; 2025 Human Capital Management System. All rights reserved.</p>
    </div>
</footer>

<!-- Script Untuk Vlookup Bunga dari Tipe Kredit -->
<script>
// Function to update Bunga field based on selected loan type
function updateBunga() {
    var tipePinjaman = document.getElementById("tipePinjaman").value;
    var bunga;
    switch(tipePinjaman) {
        case "Kredit Pemilikan Rumah (KPR)": bunga = "5%"; break;
        case "Kredit Pemilikan Ruko": bunga = "5%"; break;
        case "Kredit Multi Guna (KMG)": bunga = "7%"; break;
        case "Kredit Kendaraan Bermotor (KKB)": bunga = "4%"; break;
        case "Kredit Kendaraan Bermotor - Electronic Vehicle": bunga = "3.5%"; break;
        case "Emergency Loan": bunga = "0%"; break;
        default: bunga = ""; break;
    }

    // Set the Bunga field value
    document.getElementById("bunga").value = bunga;
}
</script>

<!-- Script Untuk Vlookup DP dari Tipe Kredit -->
<script>
    // Function to update Bunga field based on selected loan type
    function updateDP() {
        var tipePinjaman = document.getElementById("tipePinjaman").value;
        var dp;
        switch(tipePinjaman) {
            case "Kredit Pemilikan Rumah (KPR)": dp = "10%"; break;
            case "Kredit Pemilikan Ruko": dp = "30%"; break;
            default: dp = ""; break;
        }
    
        // Set the Bunga field value
        document.getElementById("dp").value = dp;
    }
    </script>

<!-- Script Untuk Vlookup DBR dari Gaji Pokok -->
<script>
// Function to update DBR field based on Gaji Pokok
function updateDBR() {
    var gajiPokok = parseFloat(document.getElementById("gajiPokok").value.replace(/\D/g, ''));
    var dbr;
    // Check the ranges for Gaji Pokok and set the corresponding DBR
    if (gajiPokok <= 10000000) {
        dbr = "30%";
        } else if (gajiPokok <= 50000000) {
        dbr = "35%";
        } else if (gajiPokok > 50000000) {
        dbr = "40%";
        } else {
        dbr = ""; // Default if no condition is met
    }
// Set the DBR field value
    document.getElementById("dbr").value = dbr;
}
</script>

<!-- Script Untuk Alert Error -->
<script>
// Custom Modal Show
function showAlert(title, message) {
    document.getElementById("modalTitle").innerText = title;
    document.getElementById("modalMessage").innerText = message;
    document.getElementById("alertModal").style.display = "block";
}
// Close the custom modal
function closeModal() {
    document.getElementById("alertModal").style.display = "none";
}
</script>

<!-- Toggle visibility of the floating info box -->
<script>

// Initialize floating box state
document.addEventListener('DOMContentLoaded', function() {
    // Initialize floating box and button
    const box = document.getElementById("floatingBox");
    const button = document.getElementById("toggleButton");
    
    // Set initial state
    box.style.display = "none";
    
    // Add click event listener to button
    button.addEventListener('click', function() {
        if (box.style.display === "none") {
            box.style.display = "block";
            this.innerHTML = '<i class="fas fa-info-circle"></i> Hide Info';
        } else {
            box.style.display = "none";
            this.innerHTML = '<i class="fas fa-info-circle"></i> Info';
        }
    });
});

function toggleInfoBox() {
    var box = document.getElementById("floatingBox");
    var button = document.getElementById("toggleButton");
    if (box.style.display === "none") {
        box.style.display = "block";
        button.innerHTML = '<i class="fas fa-info-circle"></i> Hide Info';
    } else {
        box.style.display = "none";
        button.innerHTML = '<i class="fas fa-info-circle"></i> Show Info';
    }
}
</script>

<!-- Script Generate & Reset Table -->
<script>
function genHitung(){
const plafondInput = document.getElementById("plafond").value;
const plafond = parseFloat(plafondInput.replace(/[^\d]/g, '')); // Remove all non-digits

const jangkaWaktu = parseInt(document.getElementById("jangkaWaktu").value);

const bunga = parseFloat(document.getElementById("bunga").value.replace('%', ''));
const dbr = parseFloat(document.getElementById("dbr").value.replace('%', ''));

const gajiPokokInput = document.getElementById("gajiPokok").value;
const gajiPokok = parseFloat(gajiPokokInput.replace(/[^\d]/g, '')); // Remove all non-digits

const cicilanBerjalanInput = document.getElementById("cicilanBerjalan").value;
const cicilanBerjalan = parseFloat(cicilanBerjalanInput.replace(/[^\d]/g, '')); // Remove all non-digits

const maksimalCicilan = gajiPokok * (dbr/100);
const validasiDBR = maksimalCicilan - cicilanBerjalan;

var tipePinjaman = document.getElementById("tipePinjaman").value;

// Perhitungan dengan Tabel
var sisaPinjaman = plafond; // Initialize with Plafond
// Calculate Monthly Installment based on the interest rate and plafond
var angsuran = calculatePMT(bunga,jangkaWaktu,plafond); // Monthly installment calculation

// Validate inputs
if (isNaN(plafond) || plafond <= 0) {
        showAlert("Error", "Please enter a valid plafond amount");
        return;
    }

if (isNaN(jangkaWaktu) || jangkaWaktu <= 0) {
        showAlert("Error", "Please enter a valid loan period");
        return;
}

if (!validateKMG(tipePinjaman, plafond, jangkaWaktu)) {
    return; // Stop execution if validation fails
}


if (angsuran > validasiDBR) {
    showAlert("Error", "Angsuran melebihi batas maksimal.");
    return;
}

var resultHtml = `
<div class="simulation-header">
    <h3>Hasil Simulasi</h3>
    <div class="header-line"></div>
</div>
<div class="table-wrapper">
    <table class="table table-hover sticky-table">
        <thead>
            <tr>
                <th>Angsuran Ke-</th>
                <th>Sisa Pinjaman</th>
                <th>Pokok</th>
                <th>Angsuran Bunga</th>
                <th>Total Angsuran</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>0</td>
                <td>Rp ${plafond.toLocaleString('id-ID')}</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
`;
// Loop for each month of the loan period
for (var i = 1; i <= jangkaWaktu; i++) {
// Calculate interest for the current remaining loan balance
var bungaAmount = sisaPinjaman * (bunga / 100) / 12;
// bungaAmount = Math.round(bungaAmount);
// console.log(bungaAmount)
// Calculate the principal part of the installment
var pokok = angsuran - bungaAmount;
// pokok = Math.round(pokok);
// Calculate total installment (pokok + bunga)
var angsuranTotal = pokok + bungaAmount;
// angsuranTotal = Math.round(angsuranTotal);
// Decrease the remaining balance (sisa pinjaman) by the principal portion
sisaPinjaman -= pokok;
resultHtml += `
<tr>
<td>${i}</td>
<td>Rp ${sisaPinjaman.toLocaleString()}</td>
<td>Rp ${pokok.toLocaleString()}</td>
<td>Rp ${bungaAmount.toLocaleString()}</td>
<td>Rp ${angsuranTotal.toLocaleString()}</td>
</tr>
`;
}
resultHtml += `</table>`;
document.getElementById("result").innerHTML = resultHtml;
}
function resetForm() {
document.getElementById("loanForm").reset();
document.getElementById("result").innerHTML = "";
}
</script>

<!-- Script Rumus PMT -->
<script>
function calculatePMT(interestRate, numberOfPeriods, loanAmount) {
if (interestRate == 0) {
return loanAmount / numberOfPeriods;
} else {
// Monthly interest rate
const monthlyRate = interestRate / 12 / 100;
// PMT formula
const pmt = (monthlyRate * loanAmount) / (1 - Math.pow(1 + monthlyRate, -numberOfPeriods));
return pmt;
}
}
</script>


<!-- Script get data Employee -->
<script>
function getData() {
const nikk = document.getElementById("nik").value.trim();
const checkBtn = document.getElementById("chckbtn");
// const password = document.getElementById("password").value;
// console.log(nikk);
checkBtn.disabled = true;

google.script.run.withSuccessHandler(function(response) {
checkBtn.disabled = false;

console.log(response.name);
console.log(response.status);
console.log(document.getElementById("status").value);

if (response) {
    document.getElementById("name").value = response.name;
    document.getElementById("status").value = response.status;
    
    // ✅ DEPARTMENT VALIDATION
    if (response.status === "Contract") {
        // Not Allowed
        showAlert("Anda tidak bisa mengajukan pinjaman, tetapi anda masih bisa menggunakan Simulasi Pinjaman ini.");
        console.log("Anda tidak bisa mengajukan pinjaman, tetapi anda masih bisa menggunakan Simulasi Pinjaman ini.");
    } else {
        // Not allowed
        // document.getElementById("name").value = "";
        // document.getElementById("status").value = "";
    }

} else if (nikk == "") {
    showAlert("Miss field", "Lengkapi NIK terlebih dahulu");
} else {
    showAlert("NIK Tidak Ditemukan", "Coba Lagi");
}
}).checkNIK(nikk);
}
</script>


</body>
</html>

<!-- Closing Initial Info Section -->
<script>
    function closeInitialInfo() {
        document.getElementById('initialInfoBoard').style.display = 'none';
    }
</script>

<!-- Add form validation script -->
<script>
const form = document.getElementById('loanForm');
const inputs = form.querySelectorAll('input, select');

// Add real-time validation
inputs.forEach(input => {
    input.addEventListener('input', () => {
        validateInput(input);
    });
});

function validateInput(input) {
    if (!input.checkValidity()) {
        input.classList.add('is-invalid');
        input.setAttribute('aria-invalid', 'true');
    } else {
        input.classList.remove('is-invalid');
        input.removeAttribute('aria-invalid');
    }
}

function validateKMG(tipePinjaman, plafond, jangkaWaktu) {
  if (tipePinjaman === "Kredit Multi Guna (KMG)") {
    // Check if plafond exceeds the maximum allowed value
    if (plafond > 500000000) {
      showAlert(
        "Error: Plafond Terlalu Besar",
        "Plafond Pinjaman untuk Kredit Multi Guna (KMG) tidak boleh lebih dari Rp 500,000,000"
      );
      return false; 
    }

    // Check if jangkaWaktu exceeds the maximum allowed value
    if (jangkaWaktu > 60) {
      showAlert(
        "Error: Jangka Waktu Terlalu Panjang",
        "Jangka Waktu untuk Kredit Multi Guna (KMG) tidak boleh lebih dari 5 tahun/60 bulan"
      );
      return false;  // Exit the function and prevent further calculations
    }
  }

  if (tipePinjaman === "Kredit Pemilikan Rumah (KPR)") {
    // Check if plafond exceeds the maximum allowed value
    if (plafond > 5000000000) {
      showAlert(
        "Error: Plafond Terlalu Besar",
        "Plafond Pinjaman untuk Kredit Pemilikan Rumah (KPR) tidak boleh lebih dari Rp 5,000,000,000"
      );
      return false; 
    }

    // Check if jangkaWaktu exceeds the maximum allowed value
    if (jangkaWaktu > 240) {
      showAlert(
        "Error: Jangka Waktu Terlalu Panjang",
        "Jangka Waktu untuk Kredit Pemilikan Rumah (KPR) tidak boleh lebih dari 20 tahun/240 bulan"
      );
      return false;  // Exit the function and prevent further calculations
    }
  }

  if (tipePinjaman === "Kredit Kendaraan Bermotor (KKB)") {
    // Check if plafond exceeds the maximum allowed value
    if (plafond > 700000000) {
      showAlert(
        "Error: Plafond Terlalu Besar",
        "Plafond Pinjaman untuk Kredit Kendaraan Bermotor (KKB) tidak boleh lebih dari Rp 700,000,000"
      );
      return false; 
    }

    // Check if jangkaWaktu exceeds the maximum allowed value
    if (jangkaWaktu > 240) {
      showAlert(
        "Error: Jangka Waktu Terlalu Panjang",
        "Jangka Waktu untuk Kredit Kendaraan Bermotor (KKB) tidak boleh lebih dari 5 tahun/60 bulan"
      );
      return false;  // Exit the function and prevent further calculations
    }
  }
  
  if (tipePinjaman === "Kredit Kendaraan Bermotor - Electronic Vehicle") {
    // Check if plafond exceeds the maximum allowed value
    if (plafond > 700000000) {
      showAlert(
        "Error: Plafond Terlalu Besar",
        "Plafond Pinjaman untuk Kredit Kendaraan Bermotor - Electronic Vehicle tidak boleh lebih dari Rp 700,000,000"
      );
      return false; 
    }

    // Check if jangkaWaktu exceeds the maximum allowed value
    if (jangkaWaktu > 36) {
      showAlert(
        "Error: Jangka Waktu Terlalu Panjang",
        "Jangka Waktu untuk Kredit Kendaraan Bermotor - Electronic Vehicle tidak boleh lebih dari 3 tahun/36 bulan"
      );
      return false;  // Exit the function and prevent further calculations
    }
  }

  if (tipePinjaman === "Emergency Loan") {
    // Check if plafond exceeds the maximum allowed value
    if (plafond > 100000000) {
      showAlert(
        "Error: Plafond Terlalu Besar",
        "Plafond Pinjaman untuk Emergency Loan tidak boleh lebih dari Rp 700,000,000"
      );
      return false; 
    }

    // Check if jangkaWaktu exceeds the maximum allowed value
    if (jangkaWaktu > 12) {
      showAlert(
        "Error: Jangka Waktu Terlalu Panjang",
        "Jangka Waktu untuk Emergency Loan tidak boleh lebih dari 1 tahun/12 bulan"
      );
      return false;  // Exit the function and prevent further calculations
    }
}
return true;
  
}

// Remove the existing Cleave.js initialization and replace with these functions
function formatCurrency(input) {
    // Remove all non-digits and convert to number
    let value = input.value.replace(/[^\d]/g, '');
    
    // Format the number with thousand separator and prefix
    if (value) {
        value = parseInt(value, 10).toLocaleString('id-ID');
        input.value = 'Rp ' + value;
    } else {
        input.value = '';
    }
}

// Add event listeners to the input fields
document.getElementById('plafond').addEventListener('input', function(e) {
    formatCurrency(this);
});

document.getElementById('gajiPokok').addEventListener('input', function(e) {
    formatCurrency(this);
});

document.getElementById('cicilanBerjalan').addEventListener('input', function(e) {
    formatCurrency(this);
});
</script>

