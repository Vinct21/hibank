<!DOCTYPE html>
<html lang="en">
<head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500;600&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cleave.js/1.6.0/cleave.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- <img src="https://drive.google.com/uc?export=view&id=1vWROesjizhti9mlBCwDD04mNIX4lJb1c" alt="Logo" loading="lazy" style="width: 700px;"> -->

<!-- https://drive.google.com/file/d/1vWROesjizhti9mlBCwDD04mNIX4lJb1c/view?usp=drive_link -->
<title>Hi Simulasi Pinjaman Karyawan</title>

<!-- Style for Header & Footer Section -->
<style>
    :root {
      --primary-color: #176980;
      --secondary-color: #D15B28;
      --bg-gradient: #176980;
    }
    
    body {
      font-family: 'Jost', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4; /* Light grey background */
      display: flex;
      flex-direction: column;
      min-height: 100vh; /* Ensure footer stays at bottom */
      padding-top: 100px; /* Space for fixed navbar, adjust if navbar height changes */
      overflow-x: hidden; /* Prevent horizontal scroll on body */
    }
    /* Navbar styling */
    .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding-top: 0.8rem; 
            padding-bottom: 0.8rem; 
        }

        .navbar-brand {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 1.5rem;
        }

        .nav-link {
            color: var(--primary-color);; /* Default color for nav links */
            font-weight: 500;
            transition: color 0.3s ease;
            padding-left: 0.8rem !important; 
            padding-right: 0.8rem !important;
            position: relative; /* Needed for the new span underline approach */
        }
        
        .nav-link > span {
            position: relative; /* For positioning the pseudo-element for underline */
            display: inline-block;
        }

        /* Underline animation for nav links (excluding auth buttons if any) */
        .nav-link:not(.auth-btn) > span::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px; /* Adjust this value to position the underline correctly below the text */
            left: 0;
            background-color: var(--secondary-color);
            transition: width 0.3s ease;
        }

        .nav-link:not(.auth-btn):hover > span::after {
            width: 100%;
        }
        
        .nav-link:hover,
        .nav-link.active { /* Style for active nav link and general hover */
            color: var(--secondary-color) !important; /* Ensure hover color applies */
        }

        .dropdown-item:hover {
            color: var(--secondary-color); /* Hover color for dropdown items */
        }


        /* Custom styles for dropdown menu appearance */
        .dropdown-menu {
            border-radius: 8px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
            border: 1px solid rgba(0,0,0,0.05);
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
        }
        .dropdown-item {
            font-weight: 500;
            padding: 0.5rem 1.2rem; 
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .dropdown-item:hover {
            background-color: rgba(209, 91, 40, 0.05); 
        }

        /* Arrow indicator for dropdown toggle links */
        .nav-item.dropdown > .nav-link.dropdown-toggle::after { /* Targets the ::after of the <a> tag */
            content: '\f078'; /* Font Awesome caret down icon */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            display: inline-block;
            margin-left: 0.35em;
            vertical-align: 0.05em; 
            border: none; /* Remove default Bootstrap arrow */
            transition: transform 0.3s ease;
        }
         /* Rotate arrow when dropdown is open */
        .nav-item.dropdown.show > .nav-link.dropdown-toggle::after {
            transform: rotate(180deg);
        }
        
    /* Footer styling */
    .site-footer {
      background-color: var(--primary-color);
      color: white;
      padding: 20px 0; /* Increased padding */
      width: 100%;
      text-align: center;
      font-size: 0.9rem; /* Slightly smaller font */
      margin-top: auto; /* Pushes footer to bottom */
    }
    .footer-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }
  </style>
  
  <style>
    label {
      margin-top: 0px; /* Base margin, can be overridden */
      font-weight: 500; /* Default label weight */
      color: var(--primary-color); /* Default label color */
    }
    /* General input/select styling (less specific, form-container styles will override) */
    input, select {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    /* General button styling (can be overridden by Bootstrap or specific selectors) */
    button {
      padding: 10px 15px;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 6px; /* Default border radius for buttons */
    }
    /* NIK Check Button specific style */
    #chckbtn {
      transition: all 0.2s ease-in-out;
      background: linear-gradient(45deg, var(--primary-color), #1a7b96); /* Gradient for check button */
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #chckbtn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(23, 105, 128, 0.2);
    }
    #chckbtn:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    /* Bootstrap margin utility customization */
    .mb-3 {
      margin-bottom: 1rem !important; /* Using Bootstrap's default or a bit more space */
    }
    /* Main Page Heading */
    h1 {
      text-align: center;
      margin: 0 auto; /* Center the heading block */
      padding: 30px 0;
      color: var(--primary-color);
      font-weight: 600;
      font-size: 2.2rem; /* Adjusted size */
      text-transform: uppercase;
      letter-spacing: 1px;
      border-bottom: 3px solid var(--secondary-color);
      width: fit-content; /* Make border only as wide as text */
      margin-bottom: 40px; /* Space below heading */
    }
  </style>
  
  <style>
    .simulation-header {
      width: 100%;
      text-align: center;
      margin-bottom: 25px;
    }
    .simulation-header h3 {
      color: var(--primary-color);
      font-weight: 600;
      margin: 0;
      font-size: 1.5rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .header-line {
      margin-top: 10px;
      height: 3px;
      background: linear-gradient(to right, var(--secondary-color), rgba(209, 91, 40, 0.2));
      border-radius: 2px;
    }
    .table-responsive { /* Bootstrap class, enhanced */
      overflow-x: auto;
      width: 100%;
      border-radius: 12px; /* Rounded corners for the scrollable area */
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08); /* Subtle shadow */
    }
    .table-wrapper { /* Wraps the table itself */
      border-radius: 12px; /* Match responsive wrapper */
      background: white;
      /* padding: 1px; /* Minimal padding, can be removed if not needed */
      margin-top: 20px; /* Space above table */
      overflow: hidden; /* Ensures inner content respects border radius */
      width: 100%;
    }
    .sticky-table { /* The actual table */
      width: 100%;
      border-collapse: separate; /* Allows border-spacing and rounded corners on table (though wrapper handles it) */
      border-spacing: 0;
    }
    .sticky-table th {
      background-color: var(--primary-color);
      color: white;
      font-weight: 500; /* Medium weight for headers */
      padding: 15px;
      text-align: center;
      white-space: nowrap; /* Prevent header text wrapping */
      border-bottom: 2px solid rgba(255, 255, 255, 0.1); /* Subtle border */
    }
    .sticky-table td {
      padding: 12px 15px;
      border-bottom: 1px solid #eee; /* Light separator for rows */
      text-align: right; /* Align numbers to the right */
      font-size: 0.9rem; /* Slightly smaller table data font */
      color: #333; /* Dark grey for readability */
    }
    .sticky-table tr:hover {
      background-color: #f8f9fa; /* Light hover effect for rows */
      transition: background-color 0.2s ease;
    }
    .sticky-table tr:last-child td { /* Remove border from last row */
      border-bottom: none;
    }
    .sticky-table td:first-child { /* First column (Angsuran Ke-) styling */
      text-align: center;
      font-weight: 500;
    }
    .sticky-table td:not(:first-child) { /* Other numeric columns */
      white-space: nowrap; /* Prevent numbers from wrapping */
    }
  </style>
  
  <style>
    .container {
      flex: 1; /* Allows container to grow and push footer down */
      display: flex;
      /* DEFAULT: Side-by-side layout for larger screens */
      flex-direction: row; 
      justify-content: center; /* Center the form-result group if they don't fill max-width */
      align-items: flex-start; /* Align items to the top */
      flex-wrap: wrap; /* Allows wrapping if screen becomes too narrow before media query */
      width: 100%;
      max-width: 1800px; /* Overall max-width for the content area */
      margin: 0 auto; /* Center the container itself */
      padding: 20px;
      gap: 25px; /* Increased gap for better separation */
      box-sizing: border-box;
    }
  
    .form-container {
      /* Flex properties for side-by-side layout */
      flex: 1 1 40%; /* Can grow and shrink, with a basis of ~40% */
      max-width: 750px; /* Max width for the form */
      min-width: 320px; /* Minimum width before wrapping or squishing too much */
      
      padding: 30px; /* Adjusted padding */
      background-color: white;
      border-radius: 12px; /* Softer radius */
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); /* Softer shadow */
      box-sizing: border-box;
    }
  
    .result-container {
      /* Flex properties for side-by-side layout */
      flex: 1 1 55%; /* Can grow and shrink, with a basis of ~55% */
      max-width: 1000px; /* Max width for the results, can be wider than form */
      min-width: 320px; /* Minimum width */
  
      padding: 25px; /* Adjusted padding */
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      height: auto; 
      overflow-y: auto; 
      overflow-x: auto; 
      font-size: 0.9rem; 
      display: flex;
      flex-direction: column;
      align-items: stretch; /* Stretch children like table-wrapper to full width */
      box-sizing: border-box;
    }
  
    /* Styles specific to elements within .form-container */
    .form-container form {
      display: grid;
      gap: 18px; /* Spacing between form elements/rows */
    }
    .form-container label {
      font-weight: 500;
      margin-bottom: 4px; /* Space between label and input */
      color: var(--primary-color);
      font-size: 0.9rem; /* Slightly smaller labels */
    }
    .form-container input,
    .form-container select {
      padding: 10px 12px; /* Comfortable padding */
      border: 1px solid #ced4da; /* Standard Bootstrap border color */
      border-radius: 6px;
      width: 100%;
      transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
      margin: 0; /* Remove default margins from general input/select */
      font-size: 0.95rem;
    }
    .form-container input:focus,
    .form-container select:focus {
      border-color: var(--primary-color);
      outline: 0; /* Remove default outline */
      box-shadow: 0 0 0 0.2rem rgba(23, 105, 128, 0.25); /* Focus ring */
    }
    /* Buttons within the form-container */
    .form-container .btn { /* Targeting Bootstrap .btn class specifically */
      padding: 10px 20px; /* Uniform padding for form buttons */
      font-weight: 500;
    }
    .form-container .btn-success { background-color: #28a745; border-color: #28a745; }
    .form-container .btn-secondary { background-color: #6c757d; border-color: #6c757d; }
    .form-container .btn-primary { background-color: var(--primary-color); border-color: var(--primary-color); }
  
    .form-container .btn:hover {
       filter: brightness(90%); /* Darken button on hover */
    }
  </style>
  
  <style>
    /* --- Screens < 1440px (Large Desktops / Laptops) --- */
    /* This is the primary breakpoint to switch to stacked layout */

  
    /* --- Screens < 768px (Mobile - Large) --- */
    @media (max-width: 768px) {
      body { padding-top: 60px; } /* Adjust for potentially smaller navbar */
      h1 {
        font-size: 1.7rem;
        padding: 20px 0;
        margin-bottom: 25px;
      }
      .simulation-header h3 { font-size: 1.2rem; }
      .form-container {
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
      }
      .form-container input,
      .form-container select {
        padding: 12px; /* Larger touch targets */
        font-size: 1rem; /* Prevent zoom on iOS, ensure readability */
      }
      .d-flex.gap-2 { /* Button group on mobile */
        flex-direction: column; /* Stack buttons */
        gap: 12px !important;
      }
      .d-flex.gap-2 .btn { /* Full width buttons in stacked group */
        width: 100%;
        padding: 12px;
      }
      .result-container {
        padding: 20px;
        font-size: 0.8rem; 
      }
      .sticky-table { font-size: 0.7rem; }
      .sticky-table td, .sticky-table th { padding: 8px 6px; }
      
      /* Modal adjustments for mobile */
      .modal-content { width: 90%; margin: 20px auto; padding: 20px; }
      #initialInfoBoard .modal-content { padding: 25px; }
      #initialInfoBoard ul li { font-size: 0.85rem; margin-bottom: 6px; }
  
      /* Floating box and toggle button centering for mobile */
      #floatingBox {
        width: 90%;
        bottom: 75px; /* Position above toggle button */
        left: 50%; /* Center horizontally */
        transform: translateX(-50%);
        right: auto; /* Override desktop 'right' */
        padding: 15px;
      }
      #floatingBox h6 { font-size: 1rem; margin-bottom: 10px; }
      #floatingBox p { font-size: 0.8rem; }
  
      #toggleButton {
        width: auto; /* Let content define width */
        left: 50%; /* Center horizontally */
        transform: translateX(-50%);
        right: auto; /* Override desktop 'right' */
        padding: 10px 18px;
        font-size: 0.9rem;
      }
    }
  
    /* --- Screens < 480px (Mobile - Small) --- */
    @media (max-width: 480px) {
      .container {
        padding: 10px;
        gap: 15px;
      }
      .form-container, .result-container {
        padding: 15px;
        border-radius: 10px; /* Slightly smaller radius */
      }
      h1 {
        font-size: 1.5rem;
        padding: 15px 0;
        margin-bottom: 20px;
      }
      .form-container label { font-size: 0.8rem; }
      .form-container input, .form-container select { padding: 10px; font-size: 0.95rem; }
      .form-container .btn { padding: 10px; font-size: 0.9rem;}
      .result-container { font-size: 0.75rem; }
      .simulation-header h3 { font-size: 1.1rem; }
      .sticky-table { font-size: 0.65rem; }
    }
  </style>
  
  <style>
    .modal { /* General modal backdrop and positioning */
      display: none; /* Hidden by default, shown by JS */
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5); /* Darker, standard overlay */
      backdrop-filter: blur(3px); /* Subtle blur */
      -webkit-backdrop-filter: blur(3px);
      overflow: auto; /* Enable scroll if modal content is too long */
      padding-top: 5vh; /* Push modal content down a bit */
    }
    .modal-content { /* Styling for the modal box itself */
      background-color: #fefefe;
      margin: 0 auto; /* Centered horizontally, auto top/bottom margin handled by padding-top on .modal */
      padding: 25px;
      border: none; /* Remove default border */
      border-radius: 10px; /* Softer radius */
      width: 90%; /* Responsive width */
      max-width: 600px; /* Max width for general modals */
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15); /* Enhanced shadow */
      animation: modalFadeIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* Smoother animation */
    }
    @keyframes modalFadeIn {
      from { opacity: 0; transform: translateY(-30px) scale(0.95); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    .modal-header { /* Header part of the modal */
      font-size: 1.25rem; /* Larger header text */
      font-weight: 600; /* Bolder */
      color: var(--primary-color);
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee; /* Separator line */
    }
    .modal-body { /* Body part of the modal */
      font-size: 1rem;
      color: #333;
      line-height: 1.6;
    }
    .modal-close { /* Close (X) button */
      color: #888;
      float: right;
      font-size: 1.8rem; /* Larger close icon */
      font-weight: bold;
      transition: color 0.2s ease;
    }
    .modal-close:hover,
    .modal-close:focus {
      color: #333; /* Darken on hover */
      text-decoration: none;
      cursor: pointer;
    }
  
    /* Specific styles for the Initial Information Board Modal */
    #initialInfoBoard .modal-content {
      max-width: 800px; /* Wider for more content */
      padding: 30px;
    }
    #initialInfoBoard .modal-header h4 { /* Target the h4 inside this specific modal's header */
      margin: 0;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--secondary-color);
      color: var(--primary-color);
      font-size: 1.4rem;
    }
    #initialInfoBoard ul { padding-left: 5px; } /* Align list items */
    #initialInfoBoard ul li {
      margin-bottom: 8px;
      font-size: 0.95rem;
      color: #444; /* Slightly darker text for list items */
    }
    #initialInfoBoard .loan-type h5, #initialInfoBoard .loan-type h6 {
      margin-top: 15px;
      margin-bottom: 8px;
    }
    #initialInfoBoard .loan-type ul {
      padding-left: 15px; /* Indent loan type details */
      list-style-type: disc; /* Use standard bullets */
    }
  </style>
  
  <style>
    #floatingBox {
      position: fixed;
      bottom: 85px; /* Space above toggle button */
      right: 25px;
      width: 320px; /* Slightly wider */
      padding: 20px;
      background-color: white;
      border-radius: 10px;
      border: 1px solid #e0e0e0; /* Lighter border */
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); /* Softer shadow */
      display: none; /* Initially hidden */
      z-index: 100; /* Below modals but above most content */
      transition: opacity 0.3s ease, transform 0.3s ease; /* Smooth transitions */
      transform: translateY(10px); /* Start slightly lower for entry animation */
      opacity: 0;
    }
    #floatingBox.visible { /* Class to show the box */
      display: block;
      opacity: 1;
      transform: translateY(0);
    }
    #floatingBox .card-body { padding: 0; } /* Remove Bootstrap card-body padding if not needed */
    #floatingBox h6 {
      color: var(--primary-color);
      font-weight: 600;
      font-size: 1.1rem; /* Slightly larger title */
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--secondary-color);
    }
    #floatingBox p {
      margin: 0 0 10px 0; /* Space between paragraphs */
      font-size: 0.88rem; /* Adjusted font size */
      color: #555;
      line-height: 1.5;
    }
    /* Button to toggle floating box */
    #toggleButton {
      position: fixed;
      bottom: 25px;
      right: 25px;
      padding: 12px 18px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 50px; /* Pill shape */
      cursor: pointer;
      font-weight: 500;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      box-shadow: 0 3px 10px rgba(23, 105, 128, 0.3); /* Enhanced shadow */
      z-index: 101; /* Above floating box */
    }
    #toggleButton:hover {
      background-color: #145d70; /* Darken on hover */
      transform: translateY(-2px) scale(1.05); /* Slight lift and scale */
      box-shadow: 0 5px 15px rgba(23, 105, 128, 0.4);
    }
    #toggleButton i { margin-right: 5px; } /* Space between icon and text */
  </style>
  
  <style>
    /* Styling for Bootstrap tooltips (via FontAwesome icons) */
    label .fa-info-circle { /* Target info icons within labels */
      color: var(--primary-color); 
      cursor: help;   
      margin-left: 6px;
      font-size: 1em; /* Relative to label's font size */
      transition: color 0.2s ease;
    }
    label .fa-info-circle:hover {
      color: var(--secondary-color); /* Change color on hover */
    }
    /* Ensure label and icon are vertically aligned */
    label[for="gajiPokok"],
    label[for="cicilanBerjalan"] {
      display: flex;
      align-items: center;
    }
    /* Bootstrap tooltip customization (optional) */
    .tooltip-inner {
      background-color: var(--primary-color); /* Custom background for tooltip */
      color: white;
      border-radius: 4px;
      padding: 8px 12px;
      font-size: 0.85rem;
    }
    .tooltip.bs-tooltip-top .tooltip-arrow::before {
      border-top-color: var(--primary-color); /* Match arrow color */
    }
    .tooltip.bs-tooltip-bottom .tooltip-arrow::before {
      border-bottom-color: var(--primary-color);
    }
    .tooltip.bs-tooltip-start .tooltip-arrow::before {
      border-left-color: var(--primary-color);
    }
    .tooltip.bs-tooltip-end .tooltip-arrow::before {
      border-right-color: var(--primary-color);
    }
  </style>
</head>

<body>

<!-- Initial Information Board Section -->
<div id="initialInfoBoard" class="modal" style="display: block;"> <div class="modal-content">
    <span class="modal-close" onclick="closeInitialInfo()">&times;</span>
    <div class="modal-header">
      <h4>Selamat Datang di Simulasi Pinjaman Karyawan</h4>
    </div>
    <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
      <h6 style="color: #176980; margin-top: 10px;">Syarat & Ketentuan Umum:</h6>
      <ul style="list-style-type: none; padding-left: 0;">
        <li><i class="fas fa-check-circle text-success me-2"></i>Status karyawan tetap</li>
        <li><i class="fas fa-check-circle text-success me-2"></i>Minimal masa kerja 2 tahun</li>
        <li><i class="fas fa-check-circle text-success me-2"></i>Usia minimal 21 tahun</li>
        <li><i class="fas fa-check-circle text-success me-2"></i>Memiliki rekening HiBank</li>
        <li><i class="fas fa-check-circle text-success me-2"></i>Melampirkan slip gaji terakhir</li>
        <li><i class="fas fa-check-circle text-success me-2"></i>Kinerja baik (penilaian minimum Met/setara)</li>
        <li><i class="fas fa-check-circle text-success me-2"></i>Tidak dalam sanksi/pembinaan (SP/PIP)</li>
        <li><i class="fas fa-check-circle text-success me-2"></i>IDEB SLIK 12 bulan terakhir: Lancar</li>
        <li><i class="fas fa-check-circle text-success me-2"></i>Jaminan Tanah/Bangunan (Hak Milik pribadi)</li>
        <li><i class="fas fa-check-circle text-success me-2"></i>Melengkapi formulir & dokumen</li>
        <li><i class="fas fa-check-circle text-success me-2"></i>DBR (Debt Burden Ratio) maksimal sesuai ketentuan</li>
      </ul>
      <div class="loan-info mt-4"> <h5 style="color: #176980;">Informasi Produk Pinjaman:</h5>
        <div class="loan-type mt-3">
          <h6 style="color: #D15B28; font-weight: bold;">1. Kredit Pemilikan Rumah (KPR)</h6>
          <ul>
            <li><strong>Penggunaan:</strong> Pembelian rumah, apartemen, atau ruko</li>
            <li><strong>Plafon:</strong> Maksimum Rp5 miliar</li>
            <li><strong>Tenor:</strong> Maks. 20 tahun (atau s.d. usia 55 thn saat jatuh tempo)</li>
            <li><strong>Uang Muka:</strong> 10% (rumah), 30% (ruko)</li>
            <li><strong>Suku Bunga:</strong> 5% (fixed rate)</li>
          </ul>
        </div>
        <div class="loan-type mt-3">
          <h6 style="color: #D15B28; font-weight: bold;">2. Kredit Multi Guna (KMG)</h6>
          <ul>
            <li><strong>Penggunaan:</strong> Renovasi rumah, kebutuhan konsumtif lainnya</li>
            <li><strong>Plafon:</strong> Maksimum Rp500 juta</li>
            <li><strong>Tenor:</strong> 5 tahun</li>
            <li><strong>Suku Bunga:</strong> 7% (fixed rate)</li>
          </ul>
        </div>
        <div class="loan-type mt-3">
          <h6 style="color: #D15B28; font-weight: bold;">3. Kredit Kendaraan Bermotor (KKB)</h6>
          <ul>
            <li><strong>Penggunaan:</strong> Pembelian mobil dan motor</li>
            <li><strong>Plafon:</strong> Maksimum Rp700 juta</li>
            <li><strong>Tenor:</strong> 5 tahun (3 tahun untuk kendaraan full listrik)</li>
            <li><strong>Suku Bunga:</strong> 4% (umum), 3.5% (kendaraan full listrik)</li>
          </ul>
        </div>
        <div class="loan-type mt-3">
          <h6 style="color: #D15B28; font-weight: bold;">4. Emergency Loan</h6>
          <ul>
            <li><strong>Penggunaan:</strong> Medis, bantuan finansial, pendidikan anak kandung</li>
            <li><strong>Plafon:</strong> Maksimum Rp100 juta</li>
            <li><strong>Tenor:</strong> 1 tahun</li>
            <li><strong>Suku Bunga:</strong> 0%</li>
          </ul>
        </div>
        <div class="loan-type mt-3">
          <h6 style="color: #D15B28; font-weight: bold;">5. Debt Burden Ratio (DBR) Maksimal</h6>
          <ul>
            <li>Penghasilan ≤ Rp10 juta: <strong>30%</strong></li>
            <li>Penghasilan Rp10 – 50 juta: <strong>35%</strong></li>
            <li>Penghasilan > Rp50 juta: <strong>40%</strong></li>
          </ul>
        </div>
        <button onclick="closeInitialInfo()" class="btn btn-primary w-100 mt-4" style="background-color: #176980; border-color: #176980;">
          Mulai Simulasi
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Nav Bar -->
<nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <img src="https://drive.google.com/uc?export=view&id=1vWROesjizhti9mlBCwDD04mNIX4lJb1c" alt="Bubble">
            <a class="navbar-brand mb-0" href="#">Human Capital Innovation Hub</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-expanded="true">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="navbar-collapse collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#"><span>Home</span></a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownServices" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <span>Services</span>
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdownServices">
                            <li><a class="dropdown-item" href="https://script.google.com/a/macros/hibank.co.id/s/AKfycbzfTw1Rb02K6DPyJiRfnBLc32RBzy3RCVePOWq2AEkjRaFGj2AL3Dc6tYRAC2X9E5j5nQ/exec">Loan Simulation</a></li>
                            <!-- <li><hr class="dropdown-divider"></li> -->
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="https://sites.google.com/hibank.co.id/hcinnovationhub/hc-hiro" target="_blank"><span>HC hiro</span></a></li>
                    <li class="nav-item"><a class="nav-link" href="https://sites.google.com/hibank.co.id/hcinnovationhub/gallery" target="_blank"><span>Gallery</span></a></li>
                    <li class="nav-item"><a class="nav-link" href="https://script.google.com/a/macros/hibank.co.id/s/AKfycbxpGylM2w3bstdmM3HWaQCng0I17dZDSEsXeK_w7-yqPXaj4S7M0YpgDuCBf-CKn-79/exec"><span>Feedback</span></a></li>
                    <li class="nav-item"><a class="nav-link" href="https://script.google.com/a/macros/hibank.co.id/s/AKfycbxJykSiXuFOa36BeDYqG4BVMH8sdiEtZNWf4y9_YYOrdAFTR5wXgGPSvq2YNZn2LeXn/exec"><span>FAQ</span></a></li>
                </ul>
            </div>
        </div>
    </nav>

<h1>Simulasi Pinjaman Karyawan</h1>

<div class="container">
    <div class="form-container">
      <form id="loanForm" novalidate>
        <div class="row g-3 align-items-end">
          <div class="col-md-6 col-sm-12"> <label for="nik" class="form-label">Nomor Induk Karyawan (NIK)</label>
            <div class="input-group">
              <input type="text" class="form-control" id="nik" required 
                     aria-describedby="nikHelp" pattern="[0-9]+" minlength="6" maxlength="6"
                     placeholder="Masukkan 6 digit NIK">
              <button id="chckbtn" class="btn btn-primary d-flex align-items-center justify-content-center" type="button" onclick="getData()" style="width: 42px; height: 42px; border-radius: 0 0.375rem 0.375rem 0;">
                <i class="fas fa-search fa-sm"></i>
              </button>
              <div class="invalid-feedback">NIK harus 6 digit angka.</div>
            </div>
          </div>
          <div class="col-md-6 col-sm-12"> <label for="name" class="form-label">Nama Karyawan</label>
            <input type="text" class="form-control" id="name" disabled placeholder="Nama akan muncul di sini">
          </div>
        </div>
  
        <p id="status" class="visually-hidden"></p> <div class="row g-3 align-items-end">
          <div class="col-md-7"> <label for="tipePinjaman">Tipe Pinjaman</label>
            <select id="tipePinjaman" class="form-select" required onchange="updateBunga(); updateDP();">
              <option value="" selected disabled>-- Pilih Tipe Pinjaman --</option>
              <option value="Kredit Pemilikan Rumah (KPR)">Kredit Pemilikan Rumah (KPR)</option>
              <option value="Kredit Pemilikan Ruko">Kredit Pemilikan Ruko</option>
              <option value="Kredit Multi Guna (KMG)">Kredit Multi Guna (KMG)</option>
              <option value="Kredit Kendaraan Bermotor (KKB)">Kredit Kendaraan Bermotor (KKB)</option>
              <option value="Kredit Kendaraan Bermotor - Electronic Vehicle">KKB - Kendaraan Listrik</option>
              <option value="Emergency Loan">Emergency Loan</option>
            </select>
            <div class="invalid-feedback">Silakan pilih tipe pinjaman.</div>
          </div>
          <div class="col-md-5"> <label for="dp" class="form-label">Down Payment (DP)</label>
            <input type="text" id="dp" class="form-control" disabled placeholder="Otomatis">
          </div>
        </div> 
  
        <div> <label for="plafond" class="form-label">Plafond Pinjaman</label>
          <input type="text" class="form-control" id="plafond" required placeholder="Contoh: Rp 100.000.000">
          <div class="invalid-feedback">Masukkan jumlah pinjaman.</div>
        </div>
  
        <div>
          <label for="jangkaWaktu" class="form-label">Jangka Waktu (Bulan)</label>
          <input type="number" class="form-control" id="jangkaWaktu" required min="1" placeholder="Contoh: 12">
          <div class="invalid-feedback">Masukkan jangka waktu pinjaman.</div>
        </div>
  
        <div>
          <label for="bunga">Suku Bunga Pinjaman (% p.a.)</label>
          <input type="text" id="bunga" class="form-control" disabled placeholder="Otomatis">
        </div>
  
        <div>
          <label for="gajiPokok" class="form-label">
            Penghasilan Kotor Bulanan
            <i class="fas fa-info-circle" data-bs-toggle="tooltip" 
               title="Jika Joint Income (gabungan penghasilan dengan pasangan), masukkan total penjumlahan Gaji Pokok Anda dan pasangan."></i>
          </label>
          <input type="text" class="form-control" id="gajiPokok" required onchange="updateDBR()" placeholder="Contoh: Rp 10.000.000">
          <div class="invalid-feedback">Masukkan penghasilan kotor bulanan.</div>
        </div>
  
        <div>
          <label for="dbr">DBR Maksimal</label>
          <input type="text" id="dbr" class="form-control" disabled placeholder="Otomatis">
        </div>
  
        <div>
          <label for="cicilanBerjalan">Total Cicilan Pinjaman Lain (jika ada)
            <i class="fas fa-info-circle" data-bs-toggle="tooltip" 
               title="Masukkan total angsuran bulanan dari pinjaman lain yang masih aktif, baik di Hibank maupun di luar Hibank. Isi 'Rp 0' jika tidak ada."></i>
          </label>
          <input type="text" id="cicilanBerjalan" class="form-control" value="Rp 0" placeholder="Contoh: Rp 1.000.000">
        </div>
  
        <div class="d-flex flex-wrap gap-2 mt-2"> <button type="button" class="btn btn-success flex-grow-1" onclick="validateAndSubmit()">Hitung Simulasi</button>
          <button type="button" class="btn btn-secondary flex-grow-1" onclick="resetForm()">Reset Form</button>
          <button type="button" id="downloadPdfButton" class="btn btn-primary flex-grow-1">Download PDF</button>
        </div>
      </form>
    </div> <div class="result-container">
      <div id="result" class="w-100">
          <p class="text-center text-muted p-4">Hasil simulasi akan ditampilkan di sini setelah Anda mengisi formulir dan menekan tombol "Hitung Simulasi".</p>
      </div>
    </div> </div> <div id="floatingBox" class="card"> <div class="card-body">
      <h6><i class="fas fa-clipboard-list me-2"></i>Syarat & Ketentuan (Ringkas):</h6>
      <p>• Minimal masa kerja 1 tahun (tetap)</p>
      <p>• Usia minimal 21 tahun</p>
      <p>• Rekening gaji di HiBank</p>
      <p>• Melampirkan slip gaji terakhir</p>
      <p>• DBR maksimal sesuai ketentuan Bank</p>
    </div>
</div>

<!-- Custom Modal -->
<div id="alertModal" class="modal" tabindex="-1"> <div class="modal-dialog modal-dialog-centered"> <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="modalTitle">Alert Title</h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="closeModal()"></button> </div>
    <div class="modal-body" id="modalMessage">
      Alert message goes here.
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="closeModal()">Tutup</button>
    </div>
  </div>
</div>
</div>

<button id="toggleButton" class="btn">
    <i class="fas fa-info-circle"></i> Info
  </button>

<footer class="bg-white py-5">
        <div class="container">
            <div class="row gy-4">
                <div class="col-lg-4 col-md-6">
                    <h5 class="mb-4" style="color: var(--primary-color); font-weight: 600;">Human Capital Innovation Hub</h5>
                    <p class="text-muted mb-4">Your centralized platform for managing and developing human capital. We streamline employee management and facilitate career growth.</p>
                    <div class="social-links mb-4">
                        <a href="https://www.linkedin.com/company/hibank-indonesia/" target="_blank" class="me-3" style="color: var(--primary-color);"><i class="fab fa-linkedin fa-lg"></i></a>
                        <a href="https://www.instagram.com/hibank.id?igsh=Y2V4eWl1OHgycDBk" target="_blank" class="me-3" style="color: var(--primary-color);"><i class="fab fa-instagram fa-lg"></i></a>
                    </div>
                </div>
                <div class="col-lg-2 col-md-6">
                    <h6 class="mb-4 fw-bold">Quick Links</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="https://sites.google.com/hibank.co.id/hcinnovationhub/hc-hiro" class="text-muted text-decoration-none" target="_blank">HC Squad</a></li>
                        <li class="mb-2"><a href="https://sites.google.com/hibank.co.id/hcinnovationhub/gallery" class="text-muted text-decoration-none" target="_blank">Gallery</a></li>
                        <li class="mb-2"><a href="https://script.google.com/a/macros/hibank.co.id/s/AKfycbxpGylM2w3bstdmM3HWaQCng0I17dZDSEsXeK_w7-yqPXaj4S7M0YpgDuCBf-CKn-79/exec" class="text-muted text-decoration-none">Feedback</a></li>
                        <li class="mb-2"><a href="https://script.google.com/a/macros/hibank.co.id/s/AKfycbxJykSiXuFOa36BeDYqG4BVMH8sdiEtZNWf4y9_YYOrdAFTR5wXgGPSvq2YNZn2LeXn/exec" class="text-muted text-decoration-none">FAQ</a></li>
                        <!-- <li class="mb-2"><a href="#" class="text-muted text-decoration-none">-</a></li> -->
                    </ul>
                </div>
                <div class="col-lg-2 col-md-6">
                    <h6 class="mb-4 fw-bold">Services</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="https://script.google.com/a/macros/hibank.co.id/s/AKfycbzfTw1Rb02K6DPyJiRfnBLc32RBzy3RCVePOWq2AEkjRaFGj2AL3Dc6tYRAC2X9E5j5nQ/exec" class="text-muted text-decoration-none">Loan Simulation</a></li>
                        <!-- <li class="mb-2"><a href="#" class="text-muted text-decoration-none">Internal Mobility</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none">PDF Tools</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none">Data Hub</a></li> -->
                    </ul>
                </div>
        
            </div>
            <hr class="my-4">
            <div class="row align-items-center">
                <div class="col-md-6 text-center text-md-start">
                    <p class="mb-0 text-muted">© 2025 Human Capital. All rights reserved.</p>
                </div>
            </div>
        </div>
  </footer>

<!-- Script Untuk Vlookup Bunga dari Tipe Kredit -->
<script>
    // Set current year in footer
    document.getElementById('currentYear').textContent = new Date().getFullYear();

// Initialize Bootstrap Tooltips
var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
  return new bootstrap.Tooltip(tooltipTriggerEl, {
      trigger: 'hover focus' // Show on hover and focus for accessibility
  });
});

// Function to update Bunga field based on selected loan type
function updateBunga() {
    var tipePinjaman = document.getElementById("tipePinjaman").value;
    var bunga;
    switch(tipePinjaman) {
        case "Kredit Pemilikan Rumah (KPR)": bunga = "5%"; break;
        case "Kredit Pemilikan Ruko": bunga = "5%"; break;
        case "Kredit Multi Guna (KMG)": bunga = "7%"; break;
        case "Kredit Kendaraan Bermotor (KKB)": bunga = "4%"; break;
        case "Kredit Kendaraan Bermotor - Electronic Vehicle": bunga = "3.5%"; break;
        case "Emergency Loan": bunga = "0%"; break;
        default: bunga = ""; break;
    }

    // Set the Bunga field value
    document.getElementById("bunga").value = bunga;
}
</script>

<!-- Script Untuk Vlookup DP dari Tipe Kredit -->
<script>
    // Function to update Bunga field based on selected loan type
    function updateDP() {
        var tipePinjaman = document.getElementById("tipePinjaman").value;
        var dp;
        switch(tipePinjaman) {
            case "Kredit Pemilikan Rumah (KPR)": dp = "10%"; break;
            case "Kredit Pemilikan Ruko": dp = "30%"; break;
            default: dp = ""; break;
        }
    
        // Set the Bunga field value
        document.getElementById("dp").value = dp;
    }
    </script>

<!-- Script Untuk Vlookup DBR dari Gaji Pokok -->
<script>
// Function to update DBR field based on Gaji Pokok
function updateDBR() {
    var gajiPokok = parseFloat(document.getElementById("gajiPokok").value.replace(/\D/g, ''));
    var dbr;
    // Check the ranges for Gaji Pokok and set the corresponding DBR
    if (isNaN(gajiPokok) || gajiPokok <= 0) {
      dbr = ""; // Clear DBR if income is not valid
    } else if (gajiPokok <= 10000000) {
      dbr = "30%";
    } else if (gajiPokok <= 50000000) {
      dbr = "35%";
    } else { // gajiPokok > 50000000
      dbr = "40%";
    }
    // Set the DBR field value
    document.getElementById("dbr").value = dbr;
  }

</script>

<!-- Script Untuk Alert Error -->
<script>
// Custom Modal Show
  let alertModalInstance = null; // Store modal instance
  function showAlert(title, message) {
    document.getElementById("modalTitle").innerText = title;
    document.getElementById("modalMessage").innerHTML = message; // Use innerHTML for potential HTML in message
    if (!alertModalInstance) {
        alertModalInstance = new bootstrap.Modal(document.getElementById('alertModal'));
    }
    alertModalInstance.show();
  }
  function closeModal() { // Called by modal's close buttons
     if (alertModalInstance) {
         alertModalInstance.hide();
         // Remove modal backdrop and restore page interactivity
         const backdrop = document.querySelector('.modal-backdrop');
         if (backdrop) {
             backdrop.remove();
         }
         document.body.classList.remove('modal-open');
         document.body.style.overflow = '';
         document.body.style.paddingRight = '';
     }
  }
</script>

<!-- Toggle visibility of the floating info box -->
<script>

  // Toggle visibility of the floating info box
  document.addEventListener('DOMContentLoaded', function() {
    const box = document.getElementById("floatingBox");
    const button = document.getElementById("toggleButton");
    if (box && button) {
      button.addEventListener('click', function() {
        if (box.classList.contains('visible')) {
          box.classList.remove('visible');
          this.innerHTML = '<i class="fas fa-info-circle"></i> Info';
        } else {
          box.classList.add('visible');
          this.innerHTML = '<i class="fas fa-times"></i> Tutup Info'; // Changed icon and text
        }
      });
    }
  });

    // Helper to parse currency string (e.g., "Rp 10.000.000") to float
  const parseCurrency = (valueStr) => {
    if (typeof valueStr !== 'string') return 0;
    return parseFloat(valueStr.replace(/[^0-9]/g, '')) || 0;
  };
  
  // Helper to format number to IDR currency string
  const formatToIDR = (number) => {
    if (isNaN(number)) return "Rp 0";
    return `Rp ${Math.round(number).toLocaleString('id-ID', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
  };

</script>

<!-- Script Generate & Reset Table -->
<script>
function genHitung() {
    const plafond = parseCurrency(document.getElementById("plafond").value);
    const jangkaWaktu = parseInt(document.getElementById("jangkaWaktu").value);
    const bungaAnnualPercentText = document.getElementById("bunga").value;
    const dbrPercentText = document.getElementById("dbr").value;
    const gajiPokok = parseCurrency(document.getElementById("gajiPokok").value);
    const cicilanBerjalan = parseCurrency(document.getElementById("cicilanBerjalan").value);
    const tipePinjaman = document.getElementById("tipePinjaman").value;

    // Convert percentages from text to decimal
    const bungaAnnualRate = parseFloat(bungaAnnualPercentText.replace('%', '')) / 100;
    const dbrRate = parseFloat(dbrPercentText.replace('%', '')) / 100;
    
    // --- Input Validations ---
    if (plafond <= 0) { showAlert("Input Error", "Plafond pinjaman harus lebih dari 0."); return; }
    if (isNaN(jangkaWaktu) || jangkaWaktu <= 0) { showAlert("Input Error", "Jangka waktu harus berupa angka positif."); return; }
    if (isNaN(bungaAnnualRate) || bungaAnnualRate < 0) { showAlert("Input Error", "Suku bunga tidak valid. Pilih tipe pinjaman."); return; }
    if (gajiPokok <= 0) { showAlert("Input Error", "Penghasilan kotor bulanan harus diisi dan lebih dari 0."); return; }
    if (isNaN(dbrRate) || dbrRate <= 0) { showAlert("Input Error", "DBR tidak valid. Pastikan penghasilan terisi dengan benar."); return; }

    // Loan specific term validations (max plafond, max tenor)
    if (!validateLoanTerms(tipePinjaman, plafond, jangkaWaktu)) { return; }

    const bungaMonthlyRate = bungaAnnualRate / 12;
    const angsuranBulanan = calculatePMT(bungaMonthlyRate, jangkaWaktu, plafond);

    if (isNaN(angsuranBulanan) || angsuranBulanan <= 0) {
      showAlert("Kesalahan Perhitungan", "Tidak dapat menghitung angsuran. Periksa kembali input bunga dan plafond.");
      return;
    }

    const maksimalCicilanAllowable = gajiPokok * dbrRate;
    const sisaKemampuanCicilan = maksimalCicilanAllowable - cicilanBerjalan;

    if (angsuranBulanan > sisaKemampuanCicilan) {
      showAlert("DBR Terlampaui", 
        `Angsuran bulanan (${formatToIDR(angsuranBulanan)}) melebihi batas kemampuan bayar Anda berdasarkan DBR yang tersisa (${formatToIDR(sisaKemampuanCicilan)}).<br>
         Saran: Pertimbangkan untuk mengurangi jumlah pinjaman atau memperpanjang tenor (jika memungkinkan).`);
      document.getElementById("result").innerHTML = `<p class="text-center text-danger p-4">Angsuran melebihi batas DBR.</p>`;
      return;
    }

    // --- Generate Amortization Table ---
    let sisaPinjaman = plafond;
    let resultHtml = `
    <div class="simulation-header">
      <h3>Hasil Simulasi (${tipePinjaman})</h3>
      <div class="header-line"></div>
    </div>
    <div class="table-responsive">
      <div class="table-wrapper">
        <table class="table table-hover sticky-table">
          <thead>
            <tr>
              <th>Ke-</th>
              <th>Sisa Pinjaman</th>
              <th>Pokok</th>
              <th>Bunga</th>
              <th>Total Angsuran</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-center">0</td>
              <td>${formatToIDR(plafond)}</td>
              <td class="text-center">-</td>
              <td class="text-center">-</td>
              <td class="text-center">-</td>
            </tr>`;

    for (let i = 1; i <= jangkaWaktu; i++) {
      let bungaAmount = sisaPinjaman * bungaMonthlyRate;
      let pokokAmount = angsuranBulanan - bungaAmount;
      
      // Adjustment for the last payment
      if (i === jangkaWaktu) {
        pokokAmount = sisaPinjaman; // Principal is whatever is left
        bungaAmount = angsuranBulanan - pokokAmount; 
        if (bungaAmount < 0) bungaAmount = 0; // Interest cannot be negative
      }
      
      sisaPinjaman -= pokokAmount;
      if (sisaPinjaman < 0.5) sisaPinjaman = 0; // Correct minor floating point inaccuracies to show Rp 0

      resultHtml += `
      <tr>
        <td class="text-center">${i}</td>
        <td>${formatToIDR(sisaPinjaman)}</td>
        <td>${formatToIDR(pokokAmount)}</td>
        <td>${formatToIDR(bungaAmount)}</td>
        <td>${formatToIDR(angsuranBulanan)}</td>
      </tr>`;
    }
    resultHtml += `</tbody></table></div></div>`;
    document.getElementById("result").innerHTML = resultHtml;
  }

    // Reset Form Function
  function resetForm() {
    const loanForm = document.getElementById("loanForm");
    loanForm.reset(); // Resets form fields to their initial values
    document.getElementById("result").innerHTML = '<p class="text-center text-muted p-4">Hasil simulasi akan ditampilkan di sini setelah Anda mengisi formulir dan menekan tombol "Hitung Simulasi".</p>';
    // Clear auto-filled fields explicitly
    document.getElementById("bunga").value = "";
    document.getElementById("dp").value = "";
    document.getElementById("dbr").value = "";
    document.getElementById("name").value = "";
    document.getElementById("status").textContent = ""; // Clear hidden status
    
    // Reset Bootstrap validation state
    loanForm.classList.remove('was-validated');
    const invalidInputs = loanForm.querySelectorAll('.is-invalid');
    invalidInputs.forEach(input => input.classList.remove('is-invalid'));
    // Re-apply initial value for cicilanBerjalan after reset
    document.getElementById('cicilanBerjalan').value = 'Rp 0';
    formatCurrencyInput(document.getElementById('cicilanBerjalan')); // Re-format
  }
</script>

<!-- Script Rumus PMT -->
<script>
  function calculatePMT(monthlyRate, numberOfPeriods, loanAmount) {
    if (monthlyRate === 0) { // For 0% interest loans (e.g., Emergency Loan)
      return loanAmount / numberOfPeriods;
    }
    // Standard PMT formula for loans with interest
    const pmt = (monthlyRate * loanAmount) / (1 - Math.pow(1 + monthlyRate, -numberOfPeriods));
    return pmt;
  }
</script>


<!-- Script get data Employee -->
<script>
  function getData() {
    const nikInput = document.getElementById("nik");
    const nikk = nikInput.value.trim();
    const checkBtn = document.getElementById("chckbtn");
    const originalBtnHtml = checkBtn.innerHTML; // Save original button content

    if (!nikk || !/^[0-9]{6}$/.test(nikk)) {
      showAlert("NIK Tidak Valid", "Harap masukkan 6 digit NIK yang benar.");
      nikInput.classList.add('is-invalid');
      nikInput.focus();
      return;
    }
    nikInput.classList.remove('is-invalid'); // Clear previous validation error

    checkBtn.disabled = true;
    checkBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>'; // Loading spinner

    // --- Mocking google.script.run for local development/testing ---
    if (typeof google === 'undefined' || typeof google.script === 'undefined' || typeof google.script.run === 'undefined') {
      console.warn("google.script.run is not available. Using mock NIK check.");
      setTimeout(() => {
        checkBtn.disabled = false;
        checkBtn.innerHTML = originalBtnHtml;
        let mockResponse = {};
        if (nikk === "123456") {
          mockResponse = { name: "John Doe (Mock)", status: "Permanent" };
          showAlert("NIK Ditemukan (Mock)", `Data untuk ${mockResponse.name} berhasil dimuat.`);
        } else if (nikk === "654321") {
          mockResponse = { name: "Jane Roe (Mock)", status: "Contract" };
          showAlert("Peringatan (Mock)", `Karyawan ${mockResponse.name} berstatus Kontrak dan tidak dapat mengajukan pinjaman. Simulasi tetap dapat digunakan.`);
        } else {
          mockResponse = { name: "", status: "" }; // NIK not found
          showAlert("NIK Tidak Ditemukan (Mock)", "NIK tidak terdaftar dalam sistem.");
        }
        document.getElementById("name").value = mockResponse.name;
        document.getElementById("status").textContent = mockResponse.status;
      }, 1200); // Simulate network delay
      return;
    }
    // --- Actual Google Apps Script call ---
    google.script.run
      .withSuccessHandler(function(response) {
        checkBtn.disabled = false;
        checkBtn.innerHTML = originalBtnHtml;
        if (response && response.name) {
          document.getElementById("name").value = response.name;
          document.getElementById("status").textContent = response.status;
          if (response.status === "Contract") {
            showAlert("Peringatan", `Karyawan ${response.name} berstatus Kontrak dan tidak dapat mengajukan pinjaman. Anda masih bisa menggunakan Simulasi Pinjaman ini.`);
          } else if (response.status === "Permanent") {
            showAlert("NIK Ditemukan", `Data untuk ${response.name} berhasil dimuat.`);
          } else {
            showAlert("Status Tidak Diketahui", `Status karyawan ${response.name} tidak dikenali.`);
          }
        } else {
          document.getElementById("name").value = ""; 
          document.getElementById("status").textContent = "";
          showAlert("NIK Tidak Ditemukan", "NIK tidak terdaftar atau terjadi kesalahan saat pengambilan data.");
        }
      })
      .withFailureHandler(function(error) {
        checkBtn.disabled = false;
        checkBtn.innerHTML = originalBtnHtml;
        showAlert("Error Akses Data", "Gagal menghubungi server atau mengambil data karyawan: " + error.message);
        console.error("GAS Failure: ", error);
      })
      .checkNIK(nikk); // Assuming 'checkNIK' is your GAS function name
  }

    // Close Initial Information Modal
  let initialModalInstance = null;
  function closeInitialInfo() {
    if (!initialModalInstance) {
        initialModalInstance = bootstrap.Modal.getInstance(document.getElementById('initialInfoBoard'));
    }
    if (initialModalInstance) {
      initialModalInstance.hide();
    } else { // Fallback if Bootstrap JS not fully initialized or modal instance not found
      document.getElementById('initialInfoBoard').style.display = 'none';
    }
  }

    // Ensure initial modal can be closed if Bootstrap JS loads slightly later
  document.addEventListener('DOMContentLoaded', function () {
    var initialModalElement = document.getElementById('initialInfoBoard');
    if (initialModalElement && typeof bootstrap !== 'undefined') {
      if (initialModalElement.style.display === 'block') { // Only get instance if it's meant to be shown
        initialModalInstance = new bootstrap.Modal(initialModalElement);
      }
    }
  });

    // Form Validation and Submission Logic
  function validateAndSubmit() {
    const form = document.getElementById('loanForm');
    // Remove previous validation states before re-validating
    form.classList.remove('was-validated');
    const invalidInputs = form.querySelectorAll('.is-invalid');
    invalidInputs.forEach(input => input.classList.remove('is-invalid'));

    if (!form.checkValidity()) { // HTML5 validation
      form.classList.add('was-validated'); // Trigger Bootstrap's native validation styles
      showAlert("Input Tidak Lengkap", "Harap periksa kembali dan lengkapi semua field yang wajib diisi (ditandai merah) sebelum melanjutkan.");
      const firstInvalidField = form.querySelector(':invalid');
      if (firstInvalidField) {
        firstInvalidField.focus(); // Focus the first invalid field
      }
      return;
    }
    // If all HTML5 validations pass, proceed to calculation
    genHitung(); 
  }

   // Loan Term Validation (Max Plafond, Max Tenor) based on Loan Type
  function validateLoanTerms(tipePinjaman, plafond, jangkaWaktu) {
    const loanRules = {
      "Kredit Pemilikan Rumah (KPR)": { maxPlafond: 5000000000, maxTenor: 240, name: "KPR" },
      "Kredit Pemilikan Ruko": { maxPlafond: 5000000000, maxTenor: 240, name: "KPR Ruko" },
      "Kredit Multi Guna (KMG)": { maxPlafond: 500000000, maxTenor: 60, name: "KMG" },
      "Kredit Kendaraan Bermotor (KKB)": { maxPlafond: 700000000, maxTenor: 60, name: "KKB" },
      "Kredit Kendaraan Bermotor - Electronic Vehicle": { maxPlafond: 700000000, maxTenor: 36, name: "KKB Kendaraan Listrik" },
      "Emergency Loan": { maxPlafond: 100000000, maxTenor: 12, name: "Emergency Loan" }
    };
    const rule = loanRules[tipePinjaman];
    if (!rule) { // Should not happen if dropdown is correctly populated
      showAlert("Error Sistem", "Tipe pinjaman tidak dikenali untuk validasi.");
      return false;
    }
    if (plafond > rule.maxPlafond) {
      showAlert(`Plafond Melebihi Batas untuk ${rule.name}`,
        `Plafond pinjaman untuk ${rule.name} tidak boleh lebih dari ${formatToIDR(rule.maxPlafond)}.`);
      return false;
    }
    if (jangkaWaktu > rule.maxTenor) {
      showAlert(`Tenor Melebihi Batas untuk ${rule.name}`,
        `Jangka waktu untuk ${rule.name} tidak boleh lebih dari ${rule.maxTenor / 12} tahun (${rule.maxTenor} bulan).`);
      return false;
    }
    return true; // All specific validations passed
  }

    // Currency Formatting for Input Fields
  function formatCurrencyInput(inputElement) {
    let value = inputElement.value.replace(/[^\d]/g, ''); // Remove non-digits
    if (value) {
      const numberValue = parseInt(value, 10);
      if (!isNaN(numberValue)) {
        inputElement.value = 'Rp ' + numberValue.toLocaleString('id-ID');
      } else {
        inputElement.value = 'Rp '; // Default if somehow NaN
      }
    } else {
      // If user clears the input, set to 'Rp 0' for cicilanBerjalan, empty for others
      if (inputElement.id === 'cicilanBerjalan') {
          inputElement.value = 'Rp 0';
      } else {
          inputElement.value = '';
      }
    }
  }

  // Add event listeners for real-time currency formatting
  ['plafond', 'gajiPokok', 'cicilanBerjalan'].forEach(id => {
    const element = document.getElementById(id);
    if (element) {
      // Format on input
      element.addEventListener('input', function() { formatCurrencyInput(this); });
      // Format on blur and update DBR if it's gajiPokok
      element.addEventListener('blur', function() { 
        formatCurrencyInput(this); 
        if (this.value.trim() === 'Rp' || this.value.trim() === 'Rp 0' && this.id !== 'cicilanBerjalan') {
            if (this.id !== 'cicilanBerjalan') this.value = ''; // Clear if only "Rp" or "Rp 0" unless it's cicilanBerjalan
        }
        if (this.id === 'gajiPokok') {
          updateDBR(); // Update DBR after gajiPokok is formatted and loses focus
        }
      });
      // Initial formatting for cicilanBerjalan
      if (id === 'cicilanBerjalan') {
          formatCurrencyInput(element);
      }
    }
  });

  // PDF Download Functionality
  document.getElementById('downloadPdfButton').addEventListener('click', function() {
    const { jsPDF } = window.jspdf; // Destructure from window.jspdf
    const doc = new jsPDF();
    const form = document.getElementById('loanForm');
    const resultsDiv = document.getElementById('result');

    // Check if form is valid and simulation has been run
    if (!form.checkValidity()) {
      showAlert("Tidak Bisa Download", "Harap lengkapi semua field yang valid pada formulir sebelum mengunduh PDF.");
      form.classList.add('was-validated');
      return;
    }
    if (!resultsDiv.querySelector('.sticky-table')) {
      showAlert("Tidak Bisa Download", "Belum ada hasil simulasi untuk diunduh. Silakan tekan tombol 'Hitung Simulasi' terlebih dahulu.");
      return;
    }

    doc.setFontSize(16);
    doc.setFont("helvetica", "bold");
    doc.text("Simulasi Pinjaman Karyawan - hibank", 14, 20);
    doc.setFont("helvetica", "normal");
    doc.setFontSize(10);
    doc.setTextColor(100); // Grey color for subtitles

    let yPos = 30;
    const addText = (label, value, isBold = false) => {
      if (yPos > 275) { // Check for page break
        doc.addPage();
        yPos = 20; // Reset Y position for new page
      }
      doc.setFont("helvetica", isBold ? "bold" : "normal");
      doc.text(`${label}:`, 14, yPos);
      doc.setFont("helvetica", "normal"); // Reset to normal for value
      doc.text(value || "N/A", 60, yPos); // Adjust X for value
      yPos += 7;
    };

    // Add form data to PDF
    addText("NIK Karyawan", document.getElementById('nik').value);
    addText("Nama Karyawan", document.getElementById('name').value);
    addText("Tipe Pinjaman", document.getElementById('tipePinjaman').value);
    addText("Plafond Pinjaman", document.getElementById('plafond').value, true);
    addText("Jangka Waktu", `${document.getElementById('jangkaWaktu').value} bulan`);
    addText("Suku Bunga Pinjaman", document.getElementById('bunga').value);
    addText("Penghasilan Kotor", document.getElementById('gajiPokok').value);
    addText("DBR Maksimal", document.getElementById('dbr').value);
    addText("Cicilan Pinjaman Lain", document.getElementById('cicilanBerjalan').value);
    
    // Add calculated monthly installment from table if available
    const angsuranElement = resultsDiv.querySelector('.sticky-table tbody tr:nth-child(2) td:last-child');
    if (angsurElement) {
        addText("Perkiraan Angsuran Bulanan", angsurElement.innerText, true);
    }


    yPos += 3; // Extra space before table
    doc.setLineWidth(0.2);
    doc.line(14, yPos, 196, yPos); // Separator line
    yPos += 7;


    // Add Amortization Table to PDF
    const tableElement = resultsDiv.querySelector('.sticky-table');
    if (tableElement) {
      doc.setFontSize(11);
      doc.setFont("helvetica", "bold");
      doc.text("Tabel Detail Angsuran:", 14, yPos);
      yPos += 8;

      // Using jsPDF-AutoTable plugin would be much better for complex tables.
      // This is a simplified manual rendering.
      const head = [['Ke-', 'Sisa Pinjaman', 'Pokok', 'Bunga', 'Total Angsuran']];
      const body = [];
      tableElement.querySelectorAll('tbody tr').forEach((tr, index) => {
        if (index === 0) return; // Skip the initial "0" row for PDF if it's just placeholder
        const rowData = [];
        tr.querySelectorAll('td').forEach(td => {
          rowData.push(td.innerText.replace(/Rp\s?/g, '').trim()); // Remove "Rp " and trim
        });
        body.push(rowData);
      });

      if (typeof doc.autoTable === 'function') { // Check if autoTable plugin is loaded
        doc.autoTable({
            head: head,
            body: body,
            startY: yPos,
            theme: 'grid', // 'striped', 'grid', 'plain'
            headStyles: { fillColor: [23, 105, 128] }, // --primary-color
            styles: { fontSize: 8, cellPadding: 2 },
            columnStyles: {
                0: { halign: 'center', cellWidth: 15 },
                1: { halign: 'right', cellWidth: 40 },
                2: { halign: 'right', cellWidth: 40 },
                3: { halign: 'right', cellWidth: 40 },
                4: { halign: 'right', cellWidth: 40 },
            }
        });
      } else {
        // Manual table rendering (very basic)
        doc.setFontSize(8);
        head[0].forEach((header, idx) => doc.text(header, 14 + idx * 35, yPos));
        yPos += 5;
        body.forEach(row => {
            if (yPos > 275) { doc.addPage(); yPos = 20; }
            row.forEach((cell, idx) => doc.text(cell, 14 + idx * 35, yPos));
            yPos += 5;
        });
        showAlert("Info PDF", "Tabel angsuran ditampilkan secara sederhana. Untuk tampilan tabel yang lebih baik di PDF, plugin jsPDF-AutoTable direkomendasikan.");
      }
    }
    
    // Add disclaimer
    const finalY = typeof doc.autoTable === 'function' ? doc.lastAutoTable.finalY + 10 : yPos + 10;
    if (finalY > 270) doc.addPage();
    doc.setFontSize(8);
    doc.setTextColor(150);
    doc.text("Disclaimer: Simulasi ini bersifat perkiraan dan dapat berbeda dengan perhitungan akhir bank.", 14, finalY > 270 ? 20 : finalY);
    doc.text("Syarat dan ketentuan berlaku.", 14, (finalY > 270 ? 20 : finalY) + 4);

    doc.save(`Simulasi_Pinjaman_${document.getElementById('nik').value || 'Karyawan'}.pdf`);
  });

  // Closing Initial Info Section
  function closeInitialInfo() {
        document.getElementById('initialInfoBoard').style.display = 'none';
    }

</script>

</body>
</html>

