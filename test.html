<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Org Chart Snippet with President Director</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        /* Basic styles for context - In a full app, these would be more comprehensive */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #334155;
            margin: 20px;
            display: flex;
            flex-direction: column;
            align-items: center; /* Center chart content */
        }
        .page-section-title { /* Title for each level */
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e293b;
            margin-top: 30px;
            margin-bottom: 15px;
            text-align: center;
        }
        .top-level-container { /* For President Director and CEO */
            display: inline-flex; 
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px; /* Space below PD and CEO before next level */
        }
        .group-belt {
            width: 100%;
            max-width: 1400px;
            padding: 20px;
            box-sizing: border-box;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.07);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            border-width: 2px;
            border-style: solid;
            margin-top: 20px; /* Space above belts */
        }
        .group-belt-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 15px;
            padding: 6px 12px;
            background-color: rgba(255,255,255,0.4);
            border-radius: 6px;
        }
        .belt-items-container {
            display: flex;
            flex-direction: row;
            justify-content: flex-start; /* Changed to flex-start for typical belt layout */
            align-items: flex-start;
            gap: 20px;
            width: 100%;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        .org-node {
            background-color: white;
            border: 1px solid #cbd5e1;
            border-radius: 10px;
            padding: 12px 15px;
            text-align: center;
            min-width: 180px;
            max-width: 250px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            position: relative;
            cursor: pointer;
            flex-shrink: 0;
        }
        .org-node img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin: 0 auto 8px auto;
            object-fit: cover;
            border: 2px solid #e2e8f0;
            background-color: #e2e8f0;
        }
        .org-node .title {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 5px;
        }
        .org-node .department {
            font-size: 0.7rem;
            color: #4b5563;
            background-color: rgba(240, 240, 240, 0.7);
            padding: 2px 5px;
            border-radius: 4px;
            display: inline-block;
        }
        .node-wrapper { /* Wraps each node and its potential children container */
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        .children-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0px; /* Lines will connect */
            margin-top: 20px; /* Space below parent before children */
            position: relative;
            overflow: hidden;
            max-height: 2000px; /* For animation */
            opacity: 1;
            width: 100%;
            transition: max-height 0.4s cubic-bezier(0.25, 0.1, 0.25, 1), opacity 0.4s ease-in-out, margin-top 0.4s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        .children-container.collapsed {
            max-height: 0;
            opacity: 0;
            margin-top: 0;
        }
        .toggle-button {
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #4f46e5;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 10;
        }
    </style>
</head>
<body>

    <h1 class="page-section-title">President Director</h1>
    <div id="president-director-container" class="top-level-container">
        <!-- President Director node will be rendered here -->
    </div>

    <h1 class="page-section-title">CEO Level</h1>
    <div id="ceo-level-container" class="top-level-container">
        <!-- CEO node and their direct reports (excluding directors) will be rendered here -->
    </div>

    <!-- HTML Structure for the Directorate Level Belt -->
    <div id="directorate-belt" class="group-belt"> 
        <h2 id="directorate-belt-title" class="group-belt-title">Directorate Level</h2>
        <div id="director-nodes-container" class="belt-items-container">
            <!-- Director job nodes (reporting to CEO) and their children hierarchies will be rendered here by JS -->
        </div>
    </div>

    <script>
        // --- DATA (Updated Hierarchy) ---
        const flatOrgData = [
            // President Director (New Top Level)
            { directorateGroup: 'PRESIDENT_DIRECTOR_LEVEL', division: 'Corporate', department: 'Executive Leadership', jobPosition: 'President Director', parentJobPosition: null, email: 'pres.dir@example.com', phone: '555-1000', bio: 'Guides the overall vision and strategy of the entire enterprise.', jobDescriptionLink: 'https://example.com/jd/pres-dir', isCollapsed: false },

            // CEO (Reports to President Director)
            { directorateGroup: 'CEO_LEVEL', division: 'Corporate', department: 'Executive Office', jobPosition: 'Chief Executive Officer', parentJobPosition: 'President Director', email: 'ceo@example.com', phone: '555-0001', bio: 'Overall strategic direction under the President Director.', jobDescriptionLink: 'https://example.com/jd/ceo', isCollapsed: false },

            // Director Level Jobs (reporting to CEO)
            { directorateGroup: 'Legal & Compliance', division: 'Legal Services', department: 'Corporate Law', jobPosition: 'Legal & Compliance Director', parentJobPosition: 'Chief Executive Officer', email: 'legal.dir@example.com', phone: '555-0012', bio: 'Oversees legal and compliance matters.', jobDescriptionLink: 'https://example.com/jd/legal-dir', isCollapsed: false },
            { directorateGroup: 'IT & Operations', division: 'Technology Operations', department: 'Technology Management', jobPosition: 'IT & Operation Director', parentJobPosition: 'Chief Executive Officer', email: 'it.ops.dir@example.com', phone: '555-0002', bio: 'Leads IT and Operations strategy.', jobDescriptionLink: 'https://example.com/jd/it-ops-dir', isCollapsed: false },
            { directorateGroup: 'Risk Management', division: 'Enterprise Risk', department: 'Risk Assessment', jobPosition: 'Risk Management Director', parentJobPosition: 'Chief Executive Officer', email: 'risk.dir@example.com', phone: '555-0013', bio: 'Manages enterprise risk.', jobDescriptionLink: 'https://example.com/jd/risk-dir', isCollapsed: false },
            { directorateGroup: 'Enabling Services & Finance', division: 'Finance', department: 'Accounting', jobPosition: 'Enabling Services & Finance Director', parentJobPosition: 'Chief Executive Officer', email: 'esf.dir@example.com', phone: '555-0007', bio: 'Leads enabling services and finance.', jobDescriptionLink: 'https://example.com/jd/esf-dir', isCollapsed: false },
            
            // Example child of a Director (reports to IT & Operation Director)
            { directorateGroup: 'IT & Operations', division: 'Core Tech', department: 'Engineering', jobPosition: 'VP of Engineering', parentJobPosition: 'IT & Operation Director', email: 'vp.eng@example.com', phone: '555-0003', bio: 'Manages engineering teams.', jobDescriptionLink: 'https://example.com/jd/vp-eng', isJobCollapsed: true },
        ];

        // --- DOM ELEMENTS ---
        const presidentDirectorContainerEl = document.getElementById('president-director-container');
        const ceoLevelContainerEl = document.getElementById('ceo-level-container');
        const directorateBeltEl = document.getElementById('directorate-belt');
        const directorateBeltTitleEl = document.getElementById('directorate-belt-title');
        const directorNodesContainerEl = document.getElementById('director-nodes-container'); 
        
        // --- STATE VARIABLES ---
        let presidentDirectorNode = null;
        let ceoNode = null;
        let directorNodes = []; 
        let fullHierarchy = null; 

        // --- CONFIGURATION ---
        const beltColors = {
            directorate: { background: "#E0E7FF", border: "#C7D2FE", titleColor: "#3730A3" },
        };

        // --- UTILITY FUNCTIONS ---
        function getInitials(title) {
            if (!title) return 'N/A';
            const commonWords = ['of', 'the', 'and', 'for', 'in', 'on', 'at', 'to', 'with', 'a', '-'];
            const words = title.split(/[\s-]+/) 
                               .filter(word => word && !commonWords.includes(word.toLowerCase()));
            let initials = '';
            if (words.length === 1) initials = words[0].substring(0, Math.min(words[0].length, 2)).toUpperCase();
            else if (words.length >= 2) initials = (words[0][0] + words[1][0]).toUpperCase();
            else if (words.length > 0) initials = words.map(w => w[0]).join('').substring(0,2).toUpperCase();
            else initials = title.substring(0, Math.min(title.length, 2)).toUpperCase();
            return initials.substring(0,2);
        }
        
        function buildOrgStructure(flatData) {
            let pdNode = null;
            let cNode = null;
            const dirJobEntries = [];
            const allJobEntries = [];

            flatData.forEach(job => {
                const jobEntry = { 
                    id: job.jobPosition, title: job.jobPosition, directorateGroup: job.directorateGroup,
                    division: job.division, department: job.department, email: job.email,
                    phone: job.phone, bio: job.bio, jobDescriptionLink: job.jobDescriptionLink,
                    isCollapsed: job.hasOwnProperty('isJobCollapsed') ? job.isJobCollapsed : (job.isCollapsed !== undefined ? job.isCollapsed : false), 
                    type: 'job', children: [] 
                };
                allJobEntries.push(jobEntry);

                if (job.directorateGroup === 'PRESIDENT_DIRECTOR_LEVEL') {
                    pdNode = jobEntry;
                } else if (job.directorateGroup === 'CEO_LEVEL' && job.parentJobPosition === 'President Director') {
                    cNode = jobEntry;
                } else if (job.parentJobPosition === 'Chief Executive Officer') { // Directors reporting to CEO
                    dirJobEntries.push(jobEntry);
                }
            });
            
            const jobMap = {};
            allJobEntries.forEach(j => jobMap[j.id] = j);
            let hierarchyRoot = null; // This will be the President Director
            allJobEntries.forEach(j => {
                const flatJob = flatData.find(fd => fd.jobPosition === j.id);
                if (flatJob.parentJobPosition && jobMap[flatJob.parentJobPosition]) {
                    jobMap[flatJob.parentJobPosition].children.push(j);
                } else if (!flatJob.parentJobPosition) { 
                    hierarchyRoot = j; // Should be President Director now
                }
            });
            fullHierarchy = hierarchyRoot; 

            return {
                presidentDirectorNode: pdNode,
                ceoNode: cNode,
                directorNodes: dirJobEntries
            };
        }

        function findNodeByIdInFlatData(id) { 
            return flatOrgData.find(job => job.jobPosition === id);
        }
        
        function findNodeInFullHierarchy(node, id) {
             if (!node) return null;
            if (node.id === id) return node;
            if (node.children) {
                for (const child of node.children) {
                    const found = findNodeInFullHierarchy(child, id);
                    if (found) return found;
                }
            }
            return null;
        }
        function findNodeById(id) { 
            return findNodeInFullHierarchy(fullHierarchy, id);
        }
        
        function toggleCollapse(nodeId, nodeType) {
            if (nodeType === 'job') {
                const flatDataNode = findNodeByIdInFlatData(nodeId);
                if (flatDataNode) {
                    const collapseField = flatDataNode.hasOwnProperty('isJobCollapsed') ? 'isJobCollapsed' : 'isCollapsed';
                    if (flatDataNode[collapseField] === undefined) {
                        const currentHierarchicalNode = findNodeById(nodeId);
                        flatDataNode[collapseField] = currentHierarchicalNode ? currentHierarchicalNode.isCollapsed : false;
                    }
                    flatDataNode[collapseField] = !flatDataNode[collapseField];
                }
            }
            renderOrgChart(); 
        }

        function createNodeElement(nodeData) { 
            const nodeEl = document.createElement('div');
            nodeEl.setAttribute('data-id', nodeData.id);
            nodeEl.setAttribute('data-type', nodeData.type); 
            nodeEl.classList.add('org-node');

            const initials = getInitials(nodeData.title);
            const randomHexColorForImage = Math.floor(Math.random()*12555215 + 4220000).toString(16).padStart(6, '0');
            const imageUrl = `https://placehold.co/100x100/${randomHexColorForImage}/FFFFFF?text=${initials}&font=Inter`;

            nodeEl.innerHTML = `
                <img src="${imageUrl}" alt="${nodeData.title} - ${initials}" onerror="this.onerror=null;this.src='https://placehold.co/100x100/CBD5E1/FFFFFF?text=Err&font=Inter';">
                <div class="title">${nodeData.title}</div> 
                ${nodeData.department ? `<div class="department">${nodeData.department}</div>` : ''}
            `;
            
            const hierarchicalNode = findNodeById(nodeData.id);
            if (nodeData.type === 'job' && hierarchicalNode && hierarchicalNode.children && hierarchicalNode.children.length > 0) {
                const toggleBtn = document.createElement('button');
                toggleBtn.classList.add('toggle-button');
                const flatEquivalent = findNodeByIdInFlatData(nodeData.id);
                const collapseField = flatEquivalent.hasOwnProperty('isJobCollapsed') ? 'isJobCollapsed' : 'isCollapsed';
                const isNodeCollapsed = flatEquivalent ? flatEquivalent[collapseField] : true;
                toggleBtn.innerHTML = isNodeCollapsed ? '<i class="fas fa-plus"></i>' : '<i class="fas fa-minus"></i>';
                toggleBtn.addEventListener('click', (e) => {
                    e.stopPropagation(); 
                    toggleCollapse(nodeData.id, nodeData.type);
                });
                nodeEl.appendChild(toggleBtn);
            }
            return nodeEl;
        }

        function renderRecursiveForJobs(nodeData, parentElementInDOM) { 
            if (!nodeData || nodeData.type !== 'job') return; 
            
            const nodeEl = createNodeElement(nodeData);
            const nodeWrapper = document.createElement('div');
            nodeWrapper.classList.add('node-wrapper');
            nodeWrapper.appendChild(nodeEl); 

            const hierarchicalNode = findNodeById(nodeData.id); 
            if (hierarchicalNode && hierarchicalNode.children && hierarchicalNode.children.length > 0) {
                const childrenContainerEl = document.createElement('div');
                childrenContainerEl.classList.add('children-container');
                const flatEquivalent = findNodeByIdInFlatData(nodeData.id);
                const collapseField = flatEquivalent.hasOwnProperty('isJobCollapsed') ? 'isJobCollapsed' : 'isCollapsed';
                const isNodeCollapsed = flatEquivalent ? flatEquivalent[collapseField] : true;

                if (isNodeCollapsed) {
                    childrenContainerEl.classList.add('collapsed');
                } else {
                    hierarchicalNode.children.forEach(childData => {
                        if(childData.type === 'job') {
                             renderRecursiveForJobs(childData, childrenContainerEl); 
                        }
                    });
                }
                nodeWrapper.appendChild(childrenContainerEl);
            }
            parentElementInDOM.appendChild(nodeWrapper); 
        }
        
        function renderOrgChart() {
            const orgData = buildOrgStructure(flatOrgData);
            presidentDirectorNode = orgData.presidentDirectorNode;
            ceoNode = orgData.ceoNode;
            directorNodes = orgData.directorNodes;

            // Clear previous content
            presidentDirectorContainerEl.innerHTML = '';
            ceoLevelContainerEl.innerHTML = '';
            directorNodesContainerEl.innerHTML = '';
            
            // Render President Director
            if (presidentDirectorNode) {
                renderRecursiveForJobs(findNodeById(presidentDirectorNode.id), presidentDirectorContainerEl);
            }

            // Render CEO (and their direct non-director reports, if any)
            if (ceoNode) {
                renderRecursiveForJobs(findNodeById(ceoNode.id), ceoLevelContainerEl);
            }
            
            // Style and render Directorate belt
            directorateBeltEl.style.backgroundColor = beltColors.directorate.background;
            directorateBeltEl.style.borderColor = beltColors.directorate.border;
            directorateBeltTitleEl.style.color = beltColors.directorate.titleColor;
            directorateBeltTitleEl.textContent = "Directorate Level";

            if (directorNodes && directorNodes.length > 0) {
                directorNodes.forEach(dirNodeDataFromList => {
                    const fullDirNode = findNodeById(dirNodeDataFromList.id); 
                    if (fullDirNode) {
                        renderRecursiveForJobs(fullDirNode, directorNodesContainerEl);
                    }
                });
            } else {
                directorNodesContainerEl.innerHTML = '<p>No directors to display under CEO.</p>';
            }
            // In a full app, drawLines() would be called here.
        }
        
        renderOrgChart();

    </script>
</body>
</html>
